{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/LiveQuestionsPanel.tsx",
  "created_at": "2026-02-27T05:36:27.756Z",
  "file_content": "/**\n * LiveQuestionsPanel — Painel de perguntas antecipadas para lives\n * \n * Integrado no EventDetailPage.\n * Membros enviam perguntas (anonimas ou identificadas).\n * Founder/mod pode selecionar, destacar e marcar como respondida.\n */\n\nimport { useState } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport {\n  MessageCircle, Send, Loader2, Eye, EyeOff, Star, CheckCircle,\n  ChevronDown, ChevronUp, Shield, Sparkles\n} from \"lucide-react\";\nimport { useLiveQuestions } from \"../../lib/useLiveQuestions\";\nimport { UserAvatar } from \"./UserAvatar\";\n\ninterface LiveQuestionsPanelProps {\n  eventId: string;\n  currentUserId?: string;\n  isHost: boolean; // founder ou mod que organiza a live\n  onNavigateToProfile?: (userId: string) => void;\n}\n\nexport function LiveQuestionsPanel({\n  eventId,\n  currentUserId,\n  isHost,\n  onNavigateToProfile,\n}: LiveQuestionsPanelProps) {\n  const {\n    questions,\n    isLoading,\n    submitQuestion,\n    selectQuestion,\n    markAnswered,\n  } = useLiveQuestions(eventId);\n\n  const [newQuestion, setNewQuestion] = useState(\"\");\n  const [isAnonymous, setIsAnonymous] = useState(false);\n  const [isSensitive, setIsSensitive] = useState(false);\n  const [sending, setSending] = useState(false);\n  const [showAll, setShowAll] = useState(false);\n  const [successMsg, setSuccessMsg] = useState<string | null>(null);\n\n  const selectedQuestions = questions.filter(q => q.is_selected);\n  const unselectedQuestions = questions.filter(q => !q.is_selected);\n  const myQuestions = questions.filter(q => q.user_id === currentUserId);\n\n  const handleSubmit = async () => {\n    if (!newQuestion.trim() || sending) return;\n    setSending(true);\n\n    const result = await submitQuestion(newQuestion.trim(), isAnonymous, isSensitive);\n    if (result.success) {\n      setNewQuestion(\"\");\n      setIsAnonymous(false);\n      setIsSensitive(false);\n      setSuccessMsg(\"Pergunta enviada!\");\n      setTimeout(() => setSuccessMsg(null), 2500);\n    }\n    setSending(false);\n  };\n\n  const displayQuestions = showAll ? questions : selectedQuestions;\n\n  return (\n    <div className=\"bg-white/5 border border-white/10 rounded-2xl overflow-hidden\">\n      {/* Header */}\n      <div className=\"px-5 py-4 border-b border-white/10 flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <MessageCircle className=\"h-4 w-4 text-[#81D8D0]\" />\n          <h3 className=\"text-sm text-white font-bold\">Perguntas para a Live</h3>\n          <span className=\"text-[10px] text-white/30 bg-white/5 px-2 py-0.5 rounded-full\">\n            {questions.length}\n          </span>\n        </div>\n        {isHost && questions.length > 0 && (\n          <button\n            onClick={() => setShowAll(!showAll)}\n            className=\"flex items-center gap-1 text-[11px] text-[#81D8D0] hover:text-white transition-colors\"\n          >\n            {showAll ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />}\n            {showAll ? \"So selecionadas\" : `Ver todas (${questions.length})`}\n          </button>\n        )}\n      </div>\n\n      {/* Formulário de envio */}\n      {currentUserId && (\n        <div className=\"px-5 py-4 border-b border-white/10 space-y-3\">\n          <div className=\"flex gap-2\">\n            <input\n              type=\"text\"\n              value={newQuestion}\n              onChange={(e) => setNewQuestion(e.target.value)}\n              onKeyDown={(e) => e.key === \"Enter\" && !e.shiftKey && handleSubmit()}\n              placeholder=\"Envie sua pergunta antes da live...\"\n              className=\"flex-1 px-3 py-2.5 bg-white/5 border border-white/10 rounded-xl text-white text-sm placeholder:text-white/25 focus:border-[#81D8D0]/50 focus:outline-none\"\n              maxLength={500}\n            />\n            <button\n              onClick={handleSubmit}\n              disabled={!newQuestion.trim() || sending}\n              className=\"px-3 py-2.5 bg-[#81D8D0] hover:bg-[#81D8D0]/90 disabled:opacity-40 disabled:cursor-not-allowed text-black rounded-xl transition-all\"\n            >\n              {sending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Send className=\"h-4 w-4\" />}\n            </button>\n          </div>\n\n          {/* Toggles */}\n          <div className=\"flex items-center gap-4\">\n            <button\n              onClick={() => setIsAnonymous(!isAnonymous)}\n              className={`flex items-center gap-1.5 text-[11px] px-2.5 py-1 rounded-lg transition-all ${\n                isAnonymous\n                  ? \"bg-[#FF6B35]/15 text-[#FF6B35] border border-[#FF6B35]/25\"\n                  : \"bg-white/5 text-white/40 border border-white/10 hover:bg-white/8\"\n              }`}\n            >\n              {isAnonymous ? <EyeOff className=\"h-3 w-3\" /> : <Eye className=\"h-3 w-3\" />}\n              {isAnonymous ? \"Anonima\" : \"Identificada\"}\n            </button>\n            <button\n              onClick={() => setIsSensitive(!isSensitive)}\n              className={`flex items-center gap-1.5 text-[11px] px-2.5 py-1 rounded-lg transition-all ${\n                isSensitive\n                  ? \"bg-[#C8102E]/15 text-[#C8102E] border border-[#C8102E]/25\"\n                  : \"bg-white/5 text-white/40 border border-white/10 hover:bg-white/8\"\n              }`}\n            >\n              <Shield className=\"h-3 w-3\" />\n              {isSensitive ? \"Sensivel\" : \"Normal\"}\n            </button>\n          </div>\n\n          {/* Success */}\n          <AnimatePresence>\n            {successMsg && (\n              <motion.div\n                initial={{ opacity: 0, y: -5 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0 }}\n                className=\"flex items-center gap-2 text-xs text-[#81D8D0]\"\n              >\n                <CheckCircle className=\"h-3.5 w-3.5\" />\n                {successMsg}\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      )}\n\n      {/* Lista de perguntas */}\n      <div className=\"divide-y divide-white/5\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"w-6 h-6 border-2 border-[#81D8D0] border-t-transparent rounded-full animate-spin\" />\n          </div>\n        ) : displayQuestions.length === 0 ? (\n          <div className=\"py-8 text-center\">\n            <MessageCircle className=\"h-8 w-8 text-white/10 mx-auto mb-2\" />\n            <p className=\"text-xs text-white/30\">\n              {questions.length === 0\n                ? \"Nenhuma pergunta ainda. Seja o primeiro!\"\n                : \"Nenhuma pergunta selecionada ainda.\"}\n            </p>\n          </div>\n        ) : (\n          displayQuestions.map((q) => (\n            <motion.div\n              key={q.id}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className={`px-5 py-3.5 flex items-start gap-3 transition-colors ${\n                q.is_highlighted ? \"bg-[#FF6B35]/5\" : q.is_selected ? \"bg-[#81D8D0]/5\" : \"hover:bg-white/3\"\n              }`}\n            >\n              {/* Avatar ou anonimo */}\n              {q.anonymous ? (\n                <div className=\"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0\">\n                  <EyeOff className=\"h-3.5 w-3.5 text-white/30\" />\n                </div>\n              ) : (\n                <UserAvatar\n                  name={q.author_name || \"Membro\"}\n                  photoUrl={q.author_photo}\n                  size=\"sm\"\n                  onClick={() => q.user_id && onNavigateToProfile?.(q.user_id)}\n                />\n              )}\n\n              <div className=\"flex-1 min-w-0\">\n                {/* Author */}\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className=\"text-[11px] text-white/60 font-semibold\">\n                    {q.anonymous ? \"Anonimo\" : q.author_name || \"Membro\"}\n                  </span>\n                  {q.is_sensitive && (\n                    <Shield className=\"h-3 w-3 text-[#C8102E]/60\" />\n                  )}\n                  {q.is_selected && (\n                    <span className=\"text-[9px] px-1.5 py-0.5 bg-[#81D8D0]/15 text-[#81D8D0] rounded-full font-bold\">\n                      SELECIONADA\n                    </span>\n                  )}\n                  {q.is_highlighted && (\n                    <Sparkles className=\"h-3 w-3 text-[#FF6B35]\" />\n                  )}\n                  {q.answered_live && (\n                    <span className=\"text-[9px] px-1.5 py-0.5 bg-green-500/15 text-green-400 rounded-full font-bold\">\n                      RESPONDIDA\n                    </span>\n                  )}\n                </div>\n\n                {/* Question text */}\n                <p className=\"text-sm text-white/75 leading-relaxed break-words\">\n                  {q.question_text}\n                </p>\n\n                {/* Answer summary */}\n                {q.answer_summary && (\n                  <div className=\"mt-2 pl-3 border-l-2 border-[#81D8D0]/30\">\n                    <p className=\"text-[11px] text-[#81D8D0]/60 italic\">{q.answer_summary}</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Host actions */}\n              {isHost && (\n                <div className=\"flex flex-col gap-1 flex-shrink-0\">\n                  {!q.is_selected && (\n                    <button\n                      onClick={() => selectQuestion(q.id, true)}\n                      className=\"p-1.5 bg-[#81D8D0]/10 hover:bg-[#81D8D0]/25 rounded-lg transition-colors\"\n                      title=\"Selecionar\"\n                    >\n                      <Star className=\"h-3.5 w-3.5 text-[#81D8D0]\" />\n                    </button>\n                  )}\n                  {q.is_selected && !q.answered_live && (\n                    <button\n                      onClick={() => markAnswered(q.id)}\n                      className=\"p-1.5 bg-green-500/10 hover:bg-green-500/25 rounded-lg transition-colors\"\n                      title=\"Marcar como respondida\"\n                    >\n                      <CheckCircle className=\"h-3.5 w-3.5 text-green-400\" />\n                    </button>\n                  )}\n                  {q.is_selected && (\n                    <button\n                      onClick={() => selectQuestion(q.id, false)}\n                      className=\"p-1.5 bg-white/5 hover:bg-white/10 rounded-lg transition-colors\"\n                      title=\"Desselecionar\"\n                    >\n                      <Star className=\"h-3.5 w-3.5 text-white/30\" />\n                    </button>\n                  )}\n                </div>\n              )}\n            </motion.div>\n          ))\n        )}\n      </div>\n\n      {/* Minhas perguntas (se nao sou host) */}\n      {!isHost && myQuestions.length > 0 && (\n        <div className=\"px-5 py-3 border-t border-white/10 bg-white/3\">\n          <p className=\"text-[10px] text-white/30 mb-2\">Suas perguntas ({myQuestions.length})</p>\n          {myQuestions.map(q => (\n            <div key={q.id} className=\"flex items-center gap-2 mb-1\">\n              <span className={`w-1.5 h-1.5 rounded-full flex-shrink-0 ${\n                q.answered_live ? \"bg-green-400\" : q.is_selected ? \"bg-[#81D8D0]\" : \"bg-white/20\"\n              }`} />\n              <span className=\"text-xs text-white/40 truncate\">{q.question_text}</span>\n              {q.is_selected && <Star className=\"h-2.5 w-2.5 text-[#81D8D0] flex-shrink-0\" />}\n              {q.answered_live && <CheckCircle className=\"h-2.5 w-2.5 text-green-400 flex-shrink-0\" />}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"
}