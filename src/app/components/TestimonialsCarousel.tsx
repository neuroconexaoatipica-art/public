{
  "lote": 1,
  "status": "pending",
  "file_path": "src/app/components/TestimonialsCarousel.tsx",
  "created_at": "2026-02-27T05:36:14.839Z",
  "file_content": "import { useState, useEffect, useCallback } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { Quote, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { supabase } from \"../../lib/supabase\";\nimport { UserAvatar } from \"./UserAvatar\";\n\ninterface Testimonial {\n  id: string;\n  content: string;\n  author_name: string;\n  author_photo: string | null;\n  is_approved: boolean;\n}\n\nconst FALLBACK_TESTIMONIALS: Testimonial[] = [\n  {\n    id: \"f1\",\n    content: \"Pela primeira vez na vida, eu nao preciso explicar por que penso diferente. Aqui, diferente e o padrao.\",\n    author_name: \"Membro fundador\",\n    author_photo: null,\n    is_approved: true,\n  },\n  {\n    id: \"f2\",\n    content: \"Eu desisti de redes sociais ha 3 anos. Essa e a primeira que me fez querer voltar. Porque aqui tem gente de verdade.\",\n    author_name: \"Membro fundador\",\n    author_photo: null,\n    is_approved: true,\n  },\n  {\n    id: \"f3\",\n    content: \"Os rituais mudaram minha semana. A Confissao Intelectual me fez perceber que vulnerabilidade intelectual e forca.\",\n    author_name: \"Membro fundador\",\n    author_photo: null,\n    is_approved: true,\n  },\n  {\n    id: \"f4\",\n    content: \"Nunca pensei que ia encontrar um lugar onde falar sobre neurodivergencia nao fosse 'coitadismo'. Aqui e potencia.\",\n    author_name: \"Membro fundador\",\n    author_photo: null,\n    is_approved: true,\n  },\n];\n\nexport function TestimonialsCarousel() {\n  const [testimonials, setTestimonials] = useState<Testimonial[]>(FALLBACK_TESTIMONIALS);\n  const [current, setCurrent] = useState(0);\n  const [autoPlay, setAutoPlay] = useState(true);\n\n  useEffect(() => {\n    async function loadTestimonials() {\n      try {\n        const { data, error } = await supabase\n          .from(\"testimonials\")\n          .select(\"id, content, author_id\")\n          .eq(\"is_approved\", true)\n          .order(\"created_at\", { ascending: false })\n          .limit(10);\n\n        if (!error && data && data.length > 0) {\n          const authorIds = [...new Set(data.map(t => t.author_id))];\n          const { data: authors } = await supabase\n            .from(\"users\")\n            .select(\"id, name, profile_photo\")\n            .in(\"id\", authorIds);\n\n          const authorMap: Record<string, { name: string; photo: string | null }> = {};\n          (authors || []).forEach((a: any) => {\n            authorMap[a.id] = { name: a.name, photo: a.profile_photo };\n          });\n\n          setTestimonials(\n            data.map(t => ({\n              id: t.id,\n              content: t.content,\n              author_name: authorMap[t.author_id]?.name || \"Membro\",\n              author_photo: authorMap[t.author_id]?.photo || null,\n              is_approved: true,\n            }))\n          );\n        }\n      } catch {\n        // Usar fallback silenciosamente\n      }\n    }\n    loadTestimonials();\n  }, []);\n\n  const next = useCallback(() => {\n    setCurrent(c => (c + 1) % testimonials.length);\n  }, [testimonials.length]);\n\n  const prev = useCallback(() => {\n    setCurrent(c => (c - 1 + testimonials.length) % testimonials.length);\n  }, [testimonials.length]);\n\n  // Auto-rotate\n  useEffect(() => {\n    if (!autoPlay) return;\n    const timer = setInterval(next, 6000);\n    return () => clearInterval(timer);\n  }, [autoPlay, next]);\n\n  if (testimonials.length === 0) return null;\n\n  return (\n    <section className=\"w-full py-16 md:py-20\" style={{ background: \"#D4D4D4\" }}>\n      <div className=\"mx-auto max-w-[900px] px-6 lg:px-8\">\n        {/* Header */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          whileInView={{ opacity: 1, y: 0 }}\n          viewport={{ once: true }}\n          className=\"text-center mb-10\"\n        >\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-[#C8102E]/10 border border-[#C8102E]/20 rounded-full mb-4\">\n            <Quote className=\"h-4 w-4 text-[#C8102E]\" />\n            <span className=\"text-xs text-[#C8102E] uppercase tracking-wider\" style={{ fontWeight: 700 }}>\n              Vozes de dentro\n            </span>\n          </div>\n          <h2 className=\"text-3xl md:text-4xl text-[#1A1A1A] mb-2\" style={{ fontWeight: 600 }}>\n            O que dizem os membros\n          </h2>\n          <p className=\"text-sm text-[#777]\">\n            Depoimentos reais de quem vive a plataforma\n          </p>\n        </motion.div>\n\n        {/* Carousel */}\n        <div\n          className=\"relative\"\n          onMouseEnter={() => setAutoPlay(false)}\n          onMouseLeave={() => setAutoPlay(true)}\n        >\n          <div className=\"min-h-[200px] flex items-center justify-center\">\n            <AnimatePresence mode=\"wait\">\n              <motion.div\n                key={testimonials[current].id}\n                initial={{ opacity: 0, x: 40 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -40 }}\n                transition={{ duration: 0.4 }}\n                className=\"w-full bg-white rounded-3xl p-8 md:p-10 border-2 border-[#1A1A1A]/8 shadow-sm text-center\"\n              >\n                {/* Quote mark */}\n                <Quote className=\"h-8 w-8 text-[#C8102E]/20 mx-auto mb-4\" />\n\n                {/* Content */}\n                <p className=\"text-lg md:text-xl text-[#1A1A1A] leading-relaxed mb-6 italic\" style={{ fontWeight: 400 }}>\n                  \"{testimonials[current].content}\"\n                </p>\n\n                {/* Author */}\n                <div className=\"flex items-center justify-center gap-3\">\n                  <UserAvatar\n                    name={testimonials[current].author_name}\n                    photoUrl={testimonials[current].author_photo}\n                    size=\"md\"\n                  />\n                  <div className=\"text-left\">\n                    <p className=\"text-sm text-[#1A1A1A]\" style={{ fontWeight: 600 }}>\n                      {testimonials[current].author_name}\n                    </p>\n                    <p className=\"text-xs text-[#999]\">Membro da comunidade</p>\n                  </div>\n                </div>\n              </motion.div>\n            </AnimatePresence>\n          </div>\n\n          {/* Navigation */}\n          <div className=\"flex items-center justify-center gap-4 mt-6\">\n            <button\n              onClick={prev}\n              className=\"w-10 h-10 rounded-full bg-white border-2 border-[#1A1A1A]/10 flex items-center justify-center hover:border-[#C8102E]/30 transition-colors\"\n            >\n              <ChevronLeft className=\"h-5 w-5 text-[#1A1A1A]\" />\n            </button>\n\n            {/* Dots */}\n            <div className=\"flex gap-2\">\n              {testimonials.map((_, idx) => (\n                <button\n                  key={idx}\n                  onClick={() => setCurrent(idx)}\n                  className={`w-2.5 h-2.5 rounded-full transition-all duration-300 ${\n                    idx === current\n                      ? \"bg-[#C8102E] w-6\"\n                      : \"bg-[#1A1A1A]/20 hover:bg-[#1A1A1A]/40\"\n                  }`}\n                />\n              ))}\n            </div>\n\n            <button\n              onClick={next}\n              className=\"w-10 h-10 rounded-full bg-white border-2 border-[#1A1A1A]/10 flex items-center justify-center hover:border-[#C8102E]/30 transition-colors\"\n            >\n              <ChevronRight className=\"h-5 w-5 text-[#1A1A1A]\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n"
}