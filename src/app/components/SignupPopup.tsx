{
  "lote": 2,
  "status": "pending",
  "file_path": "src/app/components/SignupPopup.tsx",
  "created_at": "2026-02-27T05:36:15.843Z",
  "file_content": "import { useState } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { X, AlertCircle, Loader2, CheckCircle, Phone } from \"lucide-react\";\nimport { supabase } from \"../../lib/supabase\";\n\ninterface SignupPopupProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSwitchToLogin: () => void;\n  onSuccess?: () => void;\n}\n\n// Formatar WhatsApp enquanto digita: (11) 99999-9999\nfunction formatWhatsApp(value: string): string {\n  const digits = value.replace(/\\D/g, '').slice(0, 11);\n  if (digits.length === 0) return '';\n  if (digits.length <= 2) return `(${digits}`;\n  if (digits.length <= 7) return `(${digits.slice(0, 2)}) ${digits.slice(2)}`;\n  return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7)}`;\n}\n\n// Extrair apenas dígitos para salvar no banco\nfunction extractDigits(value: string): string {\n  return value.replace(/\\D/g, '');\n}\n\nexport function SignupPopup({ isOpen, onClose, onSwitchToLogin, onSuccess }: SignupPopupProps) {\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [whatsapp, setWhatsapp] = useState(\"\");\n  const [allowEmail, setAllowEmail] = useState(true);\n  const [showPasswordAlert, setShowPasswordAlert] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(false);\n  const [acceptedTerms, setAcceptedTerms] = useState(false);\n  const [confirmedAge, setConfirmedAge] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    \n    // Validação de senha\n    if (password.length < 8) {\n      setShowPasswordAlert(true);\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      // Extrair dígitos do WhatsApp (se preenchido)\n      const whatsappDigits = extractDigits(whatsapp);\n      const hasWhatsapp = whatsappDigits.length >= 10;\n\n      // Criar conta no Supabase Auth\n      const { data: authData, error: authError } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: {\n            name: name,\n            whatsapp: hasWhatsapp ? whatsappDigits : null,\n            allow_whatsapp: hasWhatsapp,\n            allow_email: allowEmail,\n            terms_version: '1.0',\n          },\n          emailRedirectTo: window.location.origin,\n        }\n      });\n\n      if (authError) {\n        throw authError;\n      }\n\n      if (!authData.user) {\n        throw new Error(\"Erro ao criar conta\");\n      }\n\n      // Se user.identities está vazio, o email já existe\n      if (authData.user.identities && authData.user.identities.length === 0) {\n        setError(\"Este email já está cadastrado. Tente fazer login.\");\n        setIsLoading(false);\n        return;\n      }\n\n      // Sucesso!\n      setSuccess(true);\n      \n      setTimeout(() => {\n        setIsLoading(false);\n        onClose();\n        if (onSuccess) {\n          onSuccess();\n        }\n        resetForm();\n      }, 1200);\n\n    } catch (err: any) {\n      setIsLoading(false);\n      \n      if (err.message.includes(\"already registered\")) {\n        setError(\"Este email já está cadastrado. Tente fazer login.\");\n      } else if (err.message.includes(\"Invalid email\")) {\n        setError(\"Email inválido. Verifique e tente novamente.\");\n      } else if (err.message.includes(\"rate limit\") || err.message.includes(\"exceeded\")) {\n        setError(\"Muitas tentativas. Aguarde alguns minutos e tente novamente.\");\n      } else {\n        setError(err.message || \"Erro ao criar conta. Tente novamente.\");\n      }\n    }\n  };\n\n  const resetForm = () => {\n    setName(\"\");\n    setEmail(\"\");\n    setPassword(\"\");\n    setWhatsapp(\"\");\n    setAllowEmail(true);\n    setAcceptedTerms(false);\n    setConfirmedAge(false);\n    setSuccess(false);\n    setError(\"\");\n    setShowPasswordAlert(false);\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  const handleTermsClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    window.location.hash = 'terms';\n    window.open(`${window.location.origin}#terms`, '_blank');\n  };\n\n  const handlePrivacyClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    window.location.hash = 'privacy';\n    window.open(`${window.location.origin}#privacy`, '_blank');\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-[#35363A]/90 backdrop-blur-sm\"\n          onClick={handleClose}\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            onClick={(e) => e.stopPropagation()}\n            className=\"relative w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-8 md:p-10 border-2 border-[#81D8D0]/20 max-h-[90vh] overflow-y-auto\"\n          >\n            {/* Botão Fechar */}\n            <button\n              onClick={handleClose}\n              className=\"absolute top-4 right-4 p-2 hover:bg-[#35363A]/5 rounded-lg transition-colors\"\n            >\n              <X className=\"h-5 w-5 text-[#35363A]/60\" />\n            </button>\n\n            {/* Título */}\n            <h2 className=\"text-3xl md:text-4xl font-semibold mb-2 text-[#35363A]\">Criar sua conta</h2>\n            <p className=\"text-sm text-[#35363A]/70 mb-6 font-normal leading-relaxed\">\n              Rápido e gratuito. Seus dados ficam seguros.\n            </p>\n\n            {/* Formulário */}\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {/* Nome */}\n              <div>\n                <input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"Como prefere ser chamado(a)?\"\n                  required\n                  disabled={isLoading}\n                  className=\"w-full px-4 py-3.5 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#C8102E] focus:border-transparent transition-all text-base text-[#35363A] bg-white placeholder:text-[#35363A]/40 disabled:opacity-50\"\n                />\n              </div>\n\n              {/* Email */}\n              <div>\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"Digite seu e-mail\"\n                  required\n                  disabled={isLoading}\n                  className=\"w-full px-4 py-3.5 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#C8102E] focus:border-transparent transition-all text-base text-[#35363A] bg-white placeholder:text-[#35363A]/40 disabled:opacity-50\"\n                />\n              </div>\n\n              {/* WhatsApp — OPCIONAL */}\n              <div>\n                <div className=\"relative\">\n                  <Phone className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-[#35363A]/40\" />\n                  <input\n                    type=\"tel\"\n                    value={whatsapp}\n                    onChange={(e) => setWhatsapp(formatWhatsApp(e.target.value))}\n                    placeholder=\"WhatsApp (opcional)\"\n                    disabled={isLoading}\n                    className=\"w-full pl-12 pr-4 py-3.5 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#C8102E] focus:border-transparent transition-all text-base text-[#35363A] bg-white placeholder:text-[#35363A]/40 disabled:opacity-50\"\n                  />\n                </div>\n              </div>\n\n              {/* Senha */}\n              <div>\n                <input\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => {\n                    setPassword(e.target.value);\n                    setShowPasswordAlert(false);\n                  }}\n                  placeholder=\"Crie uma senha segura (mínimo 8 caracteres)\"\n                  required\n                  disabled={isLoading}\n                  className=\"w-full px-4 py-3.5 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#C8102E] focus:border-transparent transition-all text-base text-[#35363A] bg-white placeholder:text-[#35363A]/40 disabled:opacity-50\"\n                />\n              </div>\n\n              {/* Alerta de senha curta */}\n              <AnimatePresence>\n                {showPasswordAlert && (\n                  <motion.div\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: \"auto\" }}\n                    exit={{ opacity: 0, height: 0 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"flex items-start gap-2 p-3 bg-[#C8102E]/10 border-2 border-[#C8102E]/30 rounded-xl overflow-hidden\"\n                  >\n                    <AlertCircle className=\"h-5 w-5 text-[#C8102E] flex-shrink-0 mt-0.5\" />\n                    <p className=\"text-sm text-[#C8102E] font-semibold\">\n                      Senha precisa ter no mínimo 8 caracteres\n                    </p>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Separador visual */}\n              <div className=\"border-t border-[#35363A]/10 pt-3\">\n                <p className=\"text-xs font-semibold text-[#35363A]/50 uppercase tracking-wide mb-3\">\n                  Autorizações\n                </p>\n              </div>\n\n              {/* Checkbox Email */}\n              <div className=\"flex items-start gap-3\">\n                <input\n                  type=\"checkbox\"\n                  id=\"allow-email\"\n                  checked={allowEmail}\n                  onChange={(e) => setAllowEmail(e.target.checked)}\n                  disabled={isLoading}\n                  className=\"mt-1 h-4 w-4 rounded border-2 border-[#35363A]/30 text-[#81D8D0] focus:ring-[#81D8D0] accent-[#81D8D0] cursor-pointer\"\n                />\n                <label htmlFor=\"allow-email\" className=\"text-sm text-[#35363A]/70 cursor-pointer leading-relaxed\">\n                  Autorizo contato por <strong className=\"text-[#35363A]\">e-mail</strong>\n                </label>\n              </div>\n\n              {/* Checkbox de Idade (18+) */}\n              <div className=\"flex items-start gap-3\">\n                <input\n                  type=\"checkbox\"\n                  id=\"confirm-age\"\n                  checked={confirmedAge}\n                  onChange={(e) => setConfirmedAge(e.target.checked)}\n                  disabled={isLoading}\n                  className=\"mt-1 h-4 w-4 rounded border-2 border-[#35363A]/30 text-[#81D8D0] focus:ring-[#81D8D0] accent-[#81D8D0] cursor-pointer\"\n                />\n                <label htmlFor=\"confirm-age\" className=\"text-sm text-[#35363A]/70 cursor-pointer leading-relaxed\">\n                  Confirmo que tenho <strong className=\"text-[#35363A]\">18 anos ou mais</strong>\n                  <span className=\"text-[#C8102E] ml-1\">*</span>\n                </label>\n              </div>\n\n              {/* Checkbox de Termos */}\n              <div className=\"flex items-start gap-3\">\n                <input\n                  type=\"checkbox\"\n                  id=\"accept-terms\"\n                  checked={acceptedTerms}\n                  onChange={(e) => setAcceptedTerms(e.target.checked)}\n                  disabled={isLoading}\n                  className=\"mt-1 h-4 w-4 rounded border-2 border-[#35363A]/30 text-[#81D8D0] focus:ring-[#81D8D0] accent-[#81D8D0] cursor-pointer\"\n                />\n                <label htmlFor=\"accept-terms\" className=\"text-sm text-[#35363A]/70 cursor-pointer leading-relaxed\">\n                  Li e concordo com os{\" \"}\n                  <a href=\"#\" onClick={handleTermsClick} className=\"text-[#C8102E] font-semibold hover:underline\">\n                    Termos de Uso\n                  </a>{\" \"}\n                  e a{\" \"}\n                  <a href=\"#\" onClick={handlePrivacyClick} className=\"text-[#C8102E] font-semibold hover:underline\">\n                    Politica de Privacidade\n                  </a>\n                  <span className=\"text-[#C8102E] ml-1\">*</span>\n                </label>\n              </div>\n\n              {/* Erro */}\n              <AnimatePresence>\n                {error && (\n                  <motion.div\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: \"auto\" }}\n                    exit={{ opacity: 0, height: 0 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"flex items-start gap-2 p-3 bg-[#C8102E]/10 border-2 border-[#C8102E]/30 rounded-xl overflow-hidden\"\n                  >\n                    <AlertCircle className=\"h-5 w-5 text-[#C8102E] flex-shrink-0 mt-0.5\" />\n                    <p className=\"text-sm text-[#C8102E] font-semibold\">\n                      {error}\n                    </p>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Sucesso */}\n              <AnimatePresence>\n                {success && (\n                  <motion.div\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: \"auto\" }}\n                    exit={{ opacity: 0, height: 0 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"flex items-start gap-2 p-3 bg-[#81D8D0]/10 border-2 border-[#81D8D0]/30 rounded-xl overflow-hidden\"\n                  >\n                    <CheckCircle className=\"h-5 w-5 text-[#81D8D0] flex-shrink-0 mt-0.5\" />\n                    <div className=\"text-sm text-[#81D8D0] font-semibold\">\n                      <p>Sua conta foi criada!</p>\n                      <p className=\"font-normal mt-1\">Preparando seu espaço...</p>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Botão Submit */}\n              <motion.button\n                type=\"submit\"\n                whileHover={!isLoading ? { scale: 1.02 } : {}}\n                whileTap={!isLoading ? { scale: 0.98 } : {}}\n                disabled={isLoading || !acceptedTerms || !confirmedAge}\n                className=\"w-full py-3.5 bg-[#81D8D0] text-black rounded-xl hover:bg-[#81D8D0]/90 transition-all font-bold text-lg shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n              >\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                    Criando conta...\n                  </>\n                ) : (\n                  \"Criar minha conta\"\n                )}\n              </motion.button>\n\n              <p className=\"text-xs text-center text-[#35363A]/40 leading-relaxed\">\n                Campos marcados com <span className=\"text-[#C8102E]\">*</span> são obrigatórios\n              </p>\n            </form>\n\n            {/* Link para Login */}\n            <div className=\"mt-6 text-center\">\n              <p className=\"text-sm text-[#35363A]/70\">\n                Já tem uma conta?{\" \"}\n                <button\n                  onClick={onSwitchToLogin}\n                  className=\"text-[#C8102E] font-bold hover:underline\"\n                >\n                  Entrar\n                </button>\n              </p>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n"
}