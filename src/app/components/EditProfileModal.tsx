{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/EditProfileModal.tsx",
  "created_at": "2026-02-27T05:36:21.733Z",
  "file_content": "import { useState, useRef, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { X, Loader2, Camera, Eye, EyeOff, VolumeX, ImagePlus, Trash2, Globe, Lock, Instagram, Link2, Brain, Heart, MessageCircle, Sparkles } from \"lucide-react\";\nimport { useProfileContext, supabase, TIMEOUTS } from \"../../lib\";\nimport type { User } from \"../../lib\";\n\ninterface EditProfileModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  currentUser: User;\n  onProfileUpdated?: () => void;\n}\n\nfunction withTimeout<T>(promise: PromiseLike<T>, ms: number, label = ''): Promise<T> {\n  return Promise.race([\n    promise,\n    new Promise<T>((_, reject) =>\n      setTimeout(() => reject(new Error(`Timeout ${label} (${ms}ms)`)), ms)\n    ),\n  ]) as Promise<T>;\n}\n\n// ─── Constantes para chips selecionaveis ───\nconst PRONOUNS_OPTIONS = ['ela/dela', 'ele/dele', 'elu/delu', 'ile/dile', 'personalizado'];\n\nconst NEURODIVERGENCE_OPTIONS = [\n  'TDAH', 'TEA (Autismo)', 'Dislexia', 'Discalculia', 'Disgrafia',\n  'Altas Habilidades', 'TOC', 'Sindrome de Tourette', 'DPI (Dis. Proc. Sensorial)',\n  'Bipolaridade', 'Dispraxia',\n];\n\nconst COMMUNICATION_STYLE_OPTIONS = [\n  'Sou direto(a)', 'Preciso de contexto', 'Prefiro texto a audio',\n  'Posso demorar pra responder', 'Ironia me confunde',\n  'Preciso de pausas', 'Sou literal', 'Processo devagar e ta tudo bem',\n  'Prefiro mensagens curtas', 'Funciono melhor com listas',\n];\n\nconst INTEREST_OPTIONS = [\n  'Musica', 'Arte', 'Tecnologia', 'Natureza', 'Escrita', 'Games',\n  'Cinema', 'Podcasts', 'Filosofia', 'Psicologia', 'Meditacao',\n  'Culinaria', 'Fotografia', 'Danca', 'Livros', 'Ciencia',\n  'Educacao', 'Empreendedorismo', 'Esportes', 'Viagens',\n];\n\nexport function EditProfileModal({ isOpen, onClose, currentUser, onProfileUpdated }: EditProfileModalProps) {\n  // ─── Campos existentes ───\n  const [name, setName] = useState(currentUser.name);\n  const [bio, setBio] = useState(currentUser.bio || \"\");\n  const [deepStatement, setDeepStatement] = useState(currentUser.deep_statement || \"\");\n  const [deepStatementPublic, setDeepStatementPublic] = useState(currentUser.deep_statement_public ?? false);\n  const [isPublicProfile, setIsPublicProfile] = useState(currentUser.is_public_profile ?? true);\n  const [isAnonymousMode, setIsAnonymousMode] = useState(currentUser.is_anonymous_mode ?? false);\n  const [galleryPhotos, setGalleryPhotos] = useState<string[]>(currentUser.gallery_photos || []);\n\n  // ─── Novos campos V1.3 ───\n  const [pronouns, setPronouns] = useState(currentUser.pronouns || \"\");\n  const [customPronoun, setCustomPronoun] = useState(\"\");\n  const [neurodivergences, setNeurodivergences] = useState<string[]>(currentUser.neurodivergences || []);\n  const [neurodivergencesPublic, setNeurodivergencesPublic] = useState(currentUser.neurodivergences_public ?? false);\n  const [customNeuro, setCustomNeuro] = useState(\"\");\n  const [calmingStatement, setCalmingStatement] = useState(currentUser.calming_statement || \"\");\n  const [calmingStatementPublic, setCalmingStatementPublic] = useState(currentUser.calming_statement_public ?? true);\n  const [communicationStyle, setCommunicationStyle] = useState<string[]>(currentUser.communication_style || []);\n  const [interests, setInterests] = useState<string[]>(currentUser.interests || []);\n  const [socialInstagram, setSocialInstagram] = useState(currentUser.social_instagram || \"\");\n  const [socialLink, setSocialLink] = useState(currentUser.social_link || \"\");\n\n  // ─── Estado geral ───\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(false);\n  const [photoFile, setPhotoFile] = useState<File | null>(null);\n  const [photoPreview, setPhotoPreview] = useState<string | null>(currentUser.profile_photo);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const galleryInputRef = useRef<HTMLInputElement>(null);\n  const [galleryUploading, setGalleryUploading] = useState(false);\n  const isSavingRef = useRef(false);\n\n  const { updateProfile, uploadPhoto } = useProfileContext();\n\n  // Reset form when modal opens\n  useEffect(() => {\n    if (isOpen && !isSavingRef.current) {\n      setName(currentUser.name);\n      setBio(currentUser.bio || \"\");\n      setDeepStatement(currentUser.deep_statement || \"\");\n      setDeepStatementPublic(currentUser.deep_statement_public ?? false);\n      setIsPublicProfile(currentUser.is_public_profile ?? true);\n      setIsAnonymousMode(currentUser.is_anonymous_mode ?? false);\n      setGalleryPhotos(currentUser.gallery_photos || []);\n      setPronouns(currentUser.pronouns || \"\");\n      setCustomPronoun(\"\");\n      setNeurodivergences(currentUser.neurodivergences || []);\n      setNeurodivergencesPublic(currentUser.neurodivergences_public ?? false);\n      setCustomNeuro(\"\");\n      setCalmingStatement(currentUser.calming_statement || \"\");\n      setCalmingStatementPublic(currentUser.calming_statement_public ?? true);\n      setCommunicationStyle(currentUser.communication_style || []);\n      setInterests(currentUser.interests || []);\n      setSocialInstagram(currentUser.social_instagram || \"\");\n      setSocialLink(currentUser.social_link || \"\");\n      setPhotoPreview(currentUser.profile_photo);\n      setPhotoFile(null);\n      setError(\"\");\n      setSuccess(false);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!isOpen) isSavingRef.current = false;\n  }, [isOpen]);\n\n  const handlePhotoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    if (file.size > 5 * 1024 * 1024) { setError(\"Imagem muito grande. Maximo 5MB.\"); return; }\n    const allowed = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\n    if (!allowed.includes(file.type)) { setError(\"Use JPG, PNG ou WebP.\"); return; }\n    setPhotoFile(file);\n    const reader = new FileReader();\n    reader.onloadend = () => setPhotoPreview(reader.result as string);\n    reader.readAsDataURL(file);\n    setError(\"\");\n  };\n\n  const handleGalleryUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file || !currentUser?.id) return;\n    if (galleryPhotos.length >= 3) { setError(\"Maximo de 3 fotos na galeria.\"); return; }\n    if (file.size > 5 * 1024 * 1024) { setError(\"Imagem muito grande. Maximo 5MB.\"); return; }\n    const allowed = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\n    if (!allowed.includes(file.type)) { setError(\"Use JPG, PNG ou WebP.\"); return; }\n\n    setGalleryUploading(true);\n    setError(\"\");\n    try {\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${currentUser.id}-gallery-${Date.now()}.${fileExt}`;\n      const filePath = `profile-photos/${fileName}`;\n\n      const { error: upErr } = await withTimeout(\n        supabase.storage.from('avatars').upload(filePath, file, { cacheControl: '3600', upsert: true }),\n        TIMEOUTS.UPLOAD, 'gallery-upload'\n      );\n      if (upErr) throw upErr;\n\n      const { data: { publicUrl } } = supabase.storage.from('avatars').getPublicUrl(filePath);\n      setGalleryPhotos(prev => [...prev, publicUrl]);\n    } catch (err: any) {\n      setError(err.message || \"Erro ao fazer upload.\");\n    } finally {\n      setGalleryUploading(false);\n      if (galleryInputRef.current) galleryInputRef.current.value = \"\";\n    }\n  };\n\n  const removeGalleryPhoto = (index: number) => {\n    setGalleryPhotos(prev => prev.filter((_, i) => i !== index));\n  };\n\n  // Toggle chip in array\n  const toggleChip = (arr: string[], item: string, setter: (v: string[]) => void) => {\n    setter(arr.includes(item) ? arr.filter(x => x !== item) : [...arr, item]);\n  };\n\n  const addCustomNeuro = () => {\n    const trimmed = customNeuro.trim();\n    if (trimmed && !neurodivergences.includes(trimmed) && neurodivergences.length < 10) {\n      setNeurodivergences(prev => [...prev, trimmed]);\n      setCustomNeuro(\"\");\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (name.trim().length === 0) { setError(\"Nome nao pode estar vazio\"); return; }\n    if (name.length > 100) { setError(\"Nome muito longo. Maximo 100 caracteres\"); return; }\n    if (bio.length > 1000) { setError(\"Bio muito longa. Maximo 1000 caracteres\"); return; }\n    if (deepStatement.length > 500) { setError(\"'O que me atravessa' muito longo. Maximo 500 caracteres\"); return; }\n    if (calmingStatement.length > 500) { setError(\"'O que me acalma' muito longo. Maximo 500 caracteres\"); return; }\n\n    setError(\"\");\n    setIsLoading(true);\n    setSuccess(false);\n    isSavingRef.current = true;\n\n    // Resolve pronouns\n    let finalPronouns = pronouns;\n    if (pronouns === 'personalizado' && customPronoun.trim()) {\n      finalPronouns = customPronoun.trim().slice(0, 30);\n    } else if (pronouns === 'personalizado') {\n      finalPronouns = '';\n    }\n\n    try {\n      if (photoFile) {\n        const uploadResult = await uploadPhoto(photoFile);\n        if (!uploadResult.success) throw new Error(uploadResult.error || 'Erro ao fazer upload da foto');\n      }\n\n      const updates: Partial<User> = {\n        name: name.trim(),\n        bio: bio.trim() || null,\n        deep_statement: deepStatement.trim() || null,\n        deep_statement_public: deepStatementPublic,\n        is_public_profile: isPublicProfile,\n        is_anonymous_mode: isAnonymousMode,\n        gallery_photos: galleryPhotos,\n        pronouns: finalPronouns || null,\n        neurodivergences,\n        neurodivergences_public: neurodivergencesPublic,\n        calming_statement: calmingStatement.trim() || null,\n        calming_statement_public: calmingStatementPublic,\n        communication_style: communicationStyle,\n        interests,\n        social_instagram: socialInstagram.trim() || null,\n        social_link: socialLink.trim() || null,\n      };\n\n      const result = await updateProfile(updates);\n      if (!result.success) throw new Error(result.error || 'Erro ao atualizar perfil');\n\n      setSuccess(true);\n      isSavingRef.current = false;\n      if (onProfileUpdated) onProfileUpdated();\n      setTimeout(() => onClose(), 1500);\n    } catch (err: any) {\n      isSavingRef.current = false;\n      setError(err.message || 'Erro ao atualizar perfil. Tente novamente.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const inputClass = \"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#81D8D0] focus:border-transparent transition-all text-white placeholder:text-white/40 disabled:opacity-50\";\n\n  const chipClass = (active: boolean) =>\n    `px-3 py-1.5 rounded-lg text-xs font-semibold border transition-all cursor-pointer select-none ${\n      active\n        ? \"bg-[#81D8D0]/15 text-[#81D8D0] border-[#81D8D0]/30\"\n        : \"bg-white/3 text-white/50 border-white/10 hover:border-white/20\"\n    }`;\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-[#35363A]/90 backdrop-blur-sm px-4\"\n          onClick={onClose}\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            onClick={(e) => e.stopPropagation()}\n            className=\"relative w-full max-w-2xl bg-[#35363A] rounded-2xl shadow-2xl p-8 border border-white/10 max-h-[90vh] overflow-y-auto\"\n          >\n            <button onClick={onClose} disabled={isLoading} className=\"absolute top-4 right-4 p-2 hover:bg-white/5 rounded-lg transition-colors disabled:opacity-50\">\n              <X className=\"h-5 w-5 text-white/60\" />\n            </button>\n\n            <h2 className=\"text-2xl font-semibold mb-6 text-white\">Editar Perfil</h2>\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {/* ═══ FOTO DE PERFIL ═══ */}\n              <div className=\"flex flex-col items-center gap-4\">\n                <div className=\"relative\">\n                  <div className=\"w-32 h-32 rounded-full bg-white/10 flex items-center justify-center overflow-hidden border-4 border-[#35363A]\">\n                    {photoPreview ? (\n                      <img src={photoPreview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\n                    ) : (\n                      <span className=\"text-4xl font-bold text-white/70\">{name.charAt(0).toUpperCase()}</span>\n                    )}\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={isLoading}\n                    className=\"absolute bottom-0 right-0 p-3 bg-[#81D8D0] rounded-full hover:bg-[#81D8D0]/90 transition-colors shadow-lg disabled:opacity-50\"\n                  >\n                    <Camera className=\"h-5 w-5 text-black\" />\n                  </button>\n                </div>\n                <input type=\"file\" accept=\"image/jpeg,image/jpg,image/png,image/webp\" ref={fileInputRef} onChange={handlePhotoChange} disabled={isLoading} className=\"hidden\" />\n                <p className=\"text-xs text-white/50 text-center\">Foto principal do perfil — Maximo 5MB</p>\n              </div>\n\n              {/* ═══ GALERIA DE FOTOS (ate 3) ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  <ImagePlus className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  Galeria de fotos <span className=\"text-white/40 font-normal\">({galleryPhotos.length}/3)</span>\n                </label>\n                <p className=\"text-xs text-white/40 mb-3\">Adicione ate 3 fotos extras que representem voce.</p>\n                <div className=\"grid grid-cols-3 gap-3\">\n                  {galleryPhotos.map((url, idx) => (\n                    <div key={idx} className=\"relative aspect-square rounded-xl overflow-hidden border border-white/10 group\">\n                      <img src={url} alt={`Galeria ${idx + 1}`} className=\"w-full h-full object-cover\" />\n                      <button\n                        type=\"button\"\n                        onClick={() => removeGalleryPhoto(idx)}\n                        className=\"absolute top-1.5 right-1.5 p-1.5 bg-black/70 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity\"\n                      >\n                        <Trash2 className=\"h-3.5 w-3.5 text-[#C8102E]\" />\n                      </button>\n                    </div>\n                  ))}\n                  {galleryPhotos.length < 3 && (\n                    <button\n                      type=\"button\"\n                      onClick={() => galleryInputRef.current?.click()}\n                      disabled={galleryUploading || isLoading}\n                      className=\"aspect-square rounded-xl border-2 border-dashed border-white/20 hover:border-[#81D8D0]/50 flex flex-col items-center justify-center gap-1.5 transition-colors disabled:opacity-50\"\n                    >\n                      {galleryUploading ? (\n                        <Loader2 className=\"h-5 w-5 text-white/40 animate-spin\" />\n                      ) : (\n                        <>\n                          <ImagePlus className=\"h-5 w-5 text-white/30\" />\n                          <span className=\"text-[10px] text-white/30 font-semibold\">Adicionar</span>\n                        </>\n                      )}\n                    </button>\n                  )}\n                </div>\n                <input type=\"file\" accept=\"image/jpeg,image/jpg,image/png,image/webp\" ref={galleryInputRef} onChange={handleGalleryUpload} className=\"hidden\" />\n              </div>\n\n              {/* ═══ NOME ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  Nome <span className=\"text-[#C8102E]\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"Seu nome\"\n                  disabled={isLoading}\n                  maxLength={100}\n                  className={inputClass}\n                />\n                <p className=\"text-xs text-white/50 mt-1\">{name.length}/100 caracteres</p>\n              </div>\n\n              {/* ═══ PRONOMES ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  <Sparkles className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  Pronomes <span className=\"text-white/40 font-normal\">(opcional)</span>\n                </label>\n                <p className=\"text-xs text-white/40 mb-3\">Aparece ao lado do seu nome no perfil.</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {PRONOUNS_OPTIONS.map((opt) => (\n                    <button\n                      key={opt}\n                      type=\"button\"\n                      onClick={() => setPronouns(pronouns === opt ? \"\" : opt)}\n                      className={chipClass(pronouns === opt)}\n                    >\n                      {opt}\n                    </button>\n                  ))}\n                </div>\n                {pronouns === 'personalizado' && (\n                  <input\n                    type=\"text\"\n                    value={customPronoun}\n                    onChange={(e) => setCustomPronoun(e.target.value)}\n                    placeholder=\"Digite seus pronomes (ex: ze/zir)\"\n                    maxLength={30}\n                    className={`${inputClass} mt-3`}\n                  />\n                )}\n              </div>\n\n              {/* ═══ BIO ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">Bio / Sobre voce</label>\n                <textarea\n                  value={bio}\n                  onChange={(e) => setBio(e.target.value)}\n                  placeholder=\"Conte um pouco sobre voce, suas experiencias, o que te traz aqui...\"\n                  rows={4}\n                  disabled={isLoading}\n                  maxLength={1000}\n                  className={`${inputClass} resize-none`}\n                />\n                <p className=\"text-xs text-white/50 mt-1\">{bio.length}/1000 caracteres</p>\n              </div>\n\n              {/* ═══ NEURODIVERGENCIAS ═══ */}\n              <div className=\"border border-[#81D8D0]/15 rounded-xl p-4 bg-[#81D8D0]/3\">\n                <label className=\"block text-sm font-semibold text-white mb-1\">\n                  <Brain className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  Neurodivergencias <span className=\"text-white/40 font-normal\">(opcional)</span>\n                </label>\n                <p className=\"text-xs text-white/40 mb-3 leading-relaxed\">\n                  Auto-identificacao livre. Ninguem e obrigado a se rotular. Voce controla a visibilidade.\n                </p>\n                <div className=\"flex flex-wrap gap-2 mb-3\">\n                  {NEURODIVERGENCE_OPTIONS.map((opt) => (\n                    <button\n                      key={opt}\n                      type=\"button\"\n                      onClick={() => toggleChip(neurodivergences, opt, setNeurodivergences)}\n                      className={chipClass(neurodivergences.includes(opt))}\n                    >\n                      {opt}\n                    </button>\n                  ))}\n                  {/* Custom chips that aren't in the default list */}\n                  {neurodivergences.filter(n => !NEURODIVERGENCE_OPTIONS.includes(n)).map((custom) => (\n                    <button\n                      key={custom}\n                      type=\"button\"\n                      onClick={() => toggleChip(neurodivergences, custom, setNeurodivergences)}\n                      className={chipClass(true)}\n                    >\n                      {custom} <X className=\"h-3 w-3 inline ml-1\" />\n                    </button>\n                  ))}\n                </div>\n                {/* Add custom */}\n                <div className=\"flex gap-2\">\n                  <input\n                    type=\"text\"\n                    value={customNeuro}\n                    onChange={(e) => setCustomNeuro(e.target.value)}\n                    placeholder=\"Outro (digite e adicione)\"\n                    maxLength={40}\n                    className=\"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-xs text-white placeholder:text-white/30 focus:outline-none focus:ring-1 focus:ring-[#81D8D0]\"\n                    onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); addCustomNeuro(); } }}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={addCustomNeuro}\n                    disabled={!customNeuro.trim()}\n                    className=\"px-3 py-2 bg-[#81D8D0]/15 text-[#81D8D0] rounded-lg text-xs font-semibold disabled:opacity-30\"\n                  >\n                    + Adicionar\n                  </button>\n                </div>\n                {/* Toggle visibilidade */}\n                <div className=\"mt-3 flex justify-end\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setNeurodivergencesPublic(!neurodivergencesPublic)}\n                    className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold transition-colors ${\n                      neurodivergencesPublic\n                        ? \"bg-[#81D8D0]/15 text-[#81D8D0] border border-[#81D8D0]/30\"\n                        : \"bg-white/5 text-white/40 border border-white/10\"\n                    }`}\n                  >\n                    {neurodivergencesPublic ? <Eye className=\"h-3.5 w-3.5\" /> : <EyeOff className=\"h-3.5 w-3.5\" />}\n                    {neurodivergencesPublic ? \"Visivel no perfil\" : \"Apenas para mim\"}\n                  </button>\n                </div>\n              </div>\n\n              {/* ═══ O QUE ME ATRAVESSA (deep statement) ═══ */}\n              <div className=\"border border-[#C8102E]/20 rounded-xl p-4 bg-[#C8102E]/5\">\n                <label className=\"block text-sm font-semibold text-white mb-1\">\n                  O que me atravessa\n                </label>\n                <p className=\"text-xs text-white/40 mb-3 leading-relaxed\">\n                  Uma frase que define o que voce sente, o que te move ou te desafia. Pode ser poetica, direta, crua. E sua.\n                </p>\n                <textarea\n                  value={deepStatement}\n                  onChange={(e) => setDeepStatement(e.target.value)}\n                  placeholder=\"Ex: 'A solidao de existir num mundo que nao foi desenhado pra mim.'\"\n                  rows={2}\n                  disabled={isLoading}\n                  maxLength={500}\n                  className={`${inputClass} resize-none italic`}\n                  style={{ fontFamily: 'Lora, serif' }}\n                />\n                <div className=\"flex items-center justify-between mt-2\">\n                  <p className=\"text-xs text-white/40\">{deepStatement.length}/500</p>\n                  <button\n                    type=\"button\"\n                    onClick={() => setDeepStatementPublic(!deepStatementPublic)}\n                    className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold transition-colors ${\n                      deepStatementPublic\n                        ? \"bg-[#81D8D0]/15 text-[#81D8D0] border border-[#81D8D0]/30\"\n                        : \"bg-white/5 text-white/40 border border-white/10\"\n                    }`}\n                  >\n                    {deepStatementPublic ? <Eye className=\"h-3.5 w-3.5\" /> : <EyeOff className=\"h-3.5 w-3.5\" />}\n                    {deepStatementPublic ? \"Visivel no perfil\" : \"Apenas para mim\"}\n                  </button>\n                </div>\n              </div>\n\n              {/* ═══ O QUE ME ACALMA ═══ */}\n              <div className=\"border border-[#81D8D0]/20 rounded-xl p-4 bg-[#81D8D0]/3\">\n                <label className=\"block text-sm font-semibold text-white mb-1\">\n                  <Heart className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  O que me acalma\n                </label>\n                <p className=\"text-xs text-white/40 mb-3 leading-relaxed\">\n                  O que traz regulacao, o que cura, o que te devolve a si. Complemento ao que te atravessa.\n                </p>\n                <textarea\n                  value={calmingStatement}\n                  onChange={(e) => setCalmingStatement(e.target.value)}\n                  placeholder=\"Ex: 'O barulho da chuva, silencio compartilhado e musica sem letra.'\"\n                  rows={2}\n                  disabled={isLoading}\n                  maxLength={500}\n                  className={`${inputClass} resize-none italic`}\n                  style={{ fontFamily: 'Lora, serif' }}\n                />\n                <div className=\"flex items-center justify-between mt-2\">\n                  <p className=\"text-xs text-white/40\">{calmingStatement.length}/500</p>\n                  <button\n                    type=\"button\"\n                    onClick={() => setCalmingStatementPublic(!calmingStatementPublic)}\n                    className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold transition-colors ${\n                      calmingStatementPublic\n                        ? \"bg-[#81D8D0]/15 text-[#81D8D0] border border-[#81D8D0]/30\"\n                        : \"bg-white/5 text-white/40 border border-white/10\"\n                    }`}\n                  >\n                    {calmingStatementPublic ? <Eye className=\"h-3.5 w-3.5\" /> : <EyeOff className=\"h-3.5 w-3.5\" />}\n                    {calmingStatementPublic ? \"Visivel no perfil\" : \"Apenas para mim\"}\n                  </button>\n                </div>\n              </div>\n\n              {/* ═══ ESTILO DE COMUNICACAO ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  <MessageCircle className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  Estilo de comunicacao <span className=\"text-white/40 font-normal\">(opcional)</span>\n                </label>\n                <p className=\"text-xs text-white/40 mb-3\">Ajuda os outros a saberem como interagir com voce. Selecione quantos quiser.</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {COMMUNICATION_STYLE_OPTIONS.map((opt) => (\n                    <button\n                      key={opt}\n                      type=\"button\"\n                      onClick={() => toggleChip(communicationStyle, opt, setCommunicationStyle)}\n                      className={chipClass(communicationStyle.includes(opt))}\n                    >\n                      {opt}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* ═══ INTERESSES ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  <Sparkles className=\"h-4 w-4 inline mr-1.5 text-[#FF6B35]\" />\n                  Interesses <span className=\"text-white/40 font-normal\">(opcional)</span>\n                </label>\n                <p className=\"text-xs text-white/40 mb-3\">O que te faz perder a nocao do tempo?</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {INTEREST_OPTIONS.map((opt) => (\n                    <button\n                      key={opt}\n                      type=\"button\"\n                      onClick={() => toggleChip(interests, opt, setInterests)}\n                      className={chipClass(interests.includes(opt))}\n                    >\n                      {opt}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* ═══ LINKS SOCIAIS ═══ */}\n              <div>\n                <label className=\"block text-sm font-medium text-white/90 mb-2\">\n                  <Link2 className=\"h-4 w-4 inline mr-1.5 text-[#81D8D0]\" />\n                  Links sociais <span className=\"text-white/40 font-normal\">(opcional)</span>\n                </label>\n                <div className=\"space-y-3\">\n                  <div className=\"relative\">\n                    <Instagram className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/30\" />\n                    <input\n                      type=\"text\"\n                      value={socialInstagram}\n                      onChange={(e) => setSocialInstagram(e.target.value)}\n                      placeholder=\"@seuinstagram\"\n                      maxLength={100}\n                      disabled={isLoading}\n                      className={`${inputClass} pl-10`}\n                    />\n                  </div>\n                  <div className=\"relative\">\n                    <Link2 className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/30\" />\n                    <input\n                      type=\"text\"\n                      value={socialLink}\n                      onChange={(e) => setSocialLink(e.target.value)}\n                      placeholder=\"https://seu-site-ou-link.com\"\n                      maxLength={200}\n                      disabled={isLoading}\n                      className={`${inputClass} pl-10`}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* ═══ PRIVACIDADE & SILENCIO ═══ */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-sm font-semibold text-white flex items-center gap-2\">\n                  <Lock className=\"h-4 w-4 text-[#81D8D0]\" />\n                  Privacidade e modo silencio\n                </h3>\n\n                {/* Toggle: Perfil publico */}\n                <div\n                  className={`flex items-center justify-between p-4 rounded-xl border transition-colors cursor-pointer ${\n                    isPublicProfile ? \"bg-[#81D8D0]/10 border-[#81D8D0]/30\" : \"bg-white/3 border-white/10\"\n                  }`}\n                  onClick={() => setIsPublicProfile(!isPublicProfile)}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Globe className={`h-5 w-5 ${isPublicProfile ? \"text-[#81D8D0]\" : \"text-white/30\"}`} />\n                    <div>\n                      <p className=\"text-sm text-white font-semibold\">Perfil publico</p>\n                      <p className=\"text-xs text-white/40\">\n                        {isPublicProfile\n                          ? \"Qualquer membro pode ver seu perfil.\"\n                          : \"Seu perfil so e visivel para conexoes aprovadas.\"}\n                      </p>\n                    </div>\n                  </div>\n                  <div className={`w-11 h-6 rounded-full flex items-center transition-colors ${isPublicProfile ? \"bg-[#81D8D0]\" : \"bg-white/20\"}`}>\n                    <motion.div\n                      layout\n                      className=\"w-5 h-5 bg-white rounded-full shadow\"\n                      style={{ marginLeft: isPublicProfile ? \"auto\" : 2, marginRight: isPublicProfile ? 2 : \"auto\" }}\n                    />\n                  </div>\n                </div>\n\n                {/* Toggle: Modo silencio */}\n                <div\n                  className={`flex items-center justify-between p-4 rounded-xl border transition-colors cursor-pointer ${\n                    isAnonymousMode ? \"bg-[#C8102E]/10 border-[#C8102E]/30\" : \"bg-white/3 border-white/10\"\n                  }`}\n                  onClick={() => setIsAnonymousMode(!isAnonymousMode)}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <VolumeX className={`h-5 w-5 ${isAnonymousMode ? \"text-[#C8102E]\" : \"text-white/30\"}`} />\n                    <div>\n                      <p className=\"text-sm text-white font-semibold\">Modo silencio</p>\n                      <p className=\"text-xs text-white/40\">\n                        {isAnonymousMode\n                          ? \"Ativado — voce nao aparece em listagens e seu status fica oculto.\"\n                          : \"Desativado — voce aparece normalmente na plataforma.\"}\n                      </p>\n                    </div>\n                  </div>\n                  <div className={`w-11 h-6 rounded-full flex items-center transition-colors ${isAnonymousMode ? \"bg-[#C8102E]\" : \"bg-white/20\"}`}>\n                    <motion.div\n                      layout\n                      className=\"w-5 h-5 bg-white rounded-full shadow\"\n                      style={{ marginLeft: isAnonymousMode ? \"auto\" : 2, marginRight: isAnonymousMode ? 2 : \"auto\" }}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* ═══ FEEDBACK ═══ */}\n              {success && (\n                <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className=\"p-3 bg-[#81D8D0]/10 border border-[#81D8D0]/30 rounded-xl\">\n                  <p className=\"text-sm text-[#81D8D0] font-semibold text-center\">Perfil atualizado com sucesso!</p>\n                </motion.div>\n              )}\n              {error && (\n                <div className=\"p-3 bg-[#C8102E]/10 border border-[#C8102E]/30 rounded-xl\">\n                  <p className=\"text-sm text-[#C8102E] font-semibold\">{error}</p>\n                </div>\n              )}\n\n              {/* ═══ BOTOES ═══ */}\n              <div className=\"flex gap-3 pt-4\">\n                <button type=\"button\" onClick={onClose} disabled={isLoading} className=\"flex-1 py-3 bg-white/5 border border-white/10 text-white/90 rounded-xl hover:bg-white/10 transition-colors font-medium disabled:opacity-50\">\n                  Cancelar\n                </button>\n                <button type=\"submit\" disabled={isLoading || success} className=\"flex-1 py-3 bg-[#81D8D0] text-black rounded-xl hover:bg-[#81D8D0]/90 transition-colors font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\">\n                  {isLoading ? (<><Loader2 className=\"h-5 w-5 animate-spin\" />Salvando...</>) : success ? \"Salvo!\" : \"Salvar Alteracoes\"}\n                </button>\n              </div>\n            </form>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n"
}