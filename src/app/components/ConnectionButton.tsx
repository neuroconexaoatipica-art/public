{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/ConnectionButton.tsx",
  "created_at": "2026-02-27T05:36:22.813Z",
  "file_content": "import { useState } from \"react\";\nimport { motion } from \"motion/react\";\nimport { UserPlus, UserCheck, Clock, Loader2, Brain } from \"lucide-react\";\nimport { useConnections } from \"../../lib\";\n\ninterface ConnectionButtonProps {\n  targetUserId: string;\n  compact?: boolean;\n}\n\nexport function ConnectionButton({ targetUserId, compact = false }: ConnectionButtonProps) {\n  const { connections, sendRequest, acceptRequest, cancelRequest, isLoading } = useConnections();\n  const [actionLoading, setActionLoading] = useState(false);\n\n  // Encontrar conexao com este usuario\n  const connection = connections.find(\n    c => c.requester_id === targetUserId || c.target_id === targetUserId\n  );\n\n  const status = connection?.status;\n  const isRequester = connection?.requester_id !== targetUserId; // Eu enviei\n  const isReceiver = connection?.requester_id === targetUserId; // Ele enviou para mim\n\n  const handleAction = async () => {\n    setActionLoading(true);\n    try {\n      if (!connection) {\n        // Enviar pedido\n        await sendRequest(targetUserId);\n      } else if (status === \"pending\" && isReceiver) {\n        // Aceitar pedido recebido\n        await acceptRequest(connection.id);\n      } else if (status === \"pending\" && isRequester) {\n        // Cancelar pedido enviado\n        await cancelRequest(connection.id);\n      }\n    } catch (err) {\n      console.error(\"Erro na conexao:\", err);\n    }\n    setActionLoading(false);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"px-4 py-2 bg-white/5 rounded-lg\">\n        <Loader2 className=\"h-4 w-4 text-white/30 animate-spin\" />\n      </div>\n    );\n  }\n\n  // Definir visual baseado no status\n  let icon = Brain;\n  let label = \"Conectar mentes\";\n  let bgClass = \"bg-[#81D8D0] text-[#1A1A1A]\";\n  let hoverEffect = true;\n\n  if (status === \"accepted\") {\n    icon = UserCheck;\n    label = \"Mentes conectadas\";\n    bgClass = \"bg-white/10 text-[#81D8D0] border border-[#81D8D0]/30\";\n    hoverEffect = false;\n  } else if (status === \"pending\" && isRequester) {\n    icon = Clock;\n    label = \"Conexao pendente\";\n    bgClass = \"bg-white/5 text-white/50 border border-white/10\";\n    hoverEffect = true; // Click para cancelar\n  } else if (status === \"pending\" && isReceiver) {\n    icon = Brain;\n    label = \"Aceitar conexao\";\n    bgClass = \"bg-[#C8102E] text-white\";\n    hoverEffect = true;\n  } else if (status === \"rejected\" || status === \"blocked\") {\n    return null; // Nao mostrar botao\n  }\n\n  const Icon = icon;\n\n  return (\n    <motion.button\n      onClick={handleAction}\n      disabled={actionLoading || status === \"accepted\"}\n      whileHover={hoverEffect ? { scale: 1.03 } : {}}\n      whileTap={hoverEffect ? { scale: 0.97 } : {}}\n      className={`inline-flex items-center gap-2 rounded-xl transition-all disabled:opacity-60 ${bgClass} ${\n        compact ? \"px-3 py-1.5 text-xs\" : \"px-5 py-2.5 text-sm\"\n      }`}\n      style={{ fontWeight: 600 }}\n      title={status === \"pending\" && isRequester ? \"Clique para cancelar\" : undefined}\n    >\n      {actionLoading ? (\n        <Loader2 className={`${compact ? \"h-3 w-3\" : \"h-4 w-4\"} animate-spin`} />\n      ) : (\n        <Icon className={compact ? \"h-3 w-3\" : \"h-4 w-4\"} />\n      )}\n      {!compact && <span>{actionLoading ? \"...\" : label}</span>}\n    </motion.button>\n  );\n}"
}