{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/DailyRitualModal.tsx",
  "created_at": "2026-02-27T05:36:24.643Z",
  "file_content": "import { useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { X, Flame, Send, Zap } from \"lucide-react\";\nimport { useDailyChallenge } from \"../../lib\";\n\ninterface DailyRitualModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst CHALLENGE_ICONS: Record<string, string> = {\n  reflexao: \"ðŸ§ \",\n  acao: \"âš¡\",\n  escrita: \"âœï¸\",\n  conexao: \"ðŸ¤\",\n  presenca: \"ðŸ‘ï¸\",\n  provocacao: \"ðŸ”¥\",\n  confissao: \"ðŸ’­\",\n};\n\n// Frases aleatorias para quando nao tem desafio programado\nconst FREE_PROMPTS = [\n  \"O que voce esta sentindo agora, sem filtro?\",\n  \"Uma palavra que resume seu dia ate aqui.\",\n  \"O que voce precisa ouvir hoje que ninguem te disse?\",\n  \"Qual pensamento nao te larga?\",\n  \"Se pudesse pausar uma coisa agora, o que seria?\",\n  \"O que voce esta evitando?\",\n  \"Uma coisa boa â€” por menor que seja â€” que aconteceu hoje.\",\n];\n\nexport function DailyRitualModal({ isOpen, onClose }: DailyRitualModalProps) {\n  const { todayChallenge, todayCheckin, streak, submitCheckin, isLoading } = useDailyChallenge();\n  const [response, setResponse] = useState(\"\");\n  const [submitted, setSubmitted] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // Prompt livre para dias sem desafio\n  const [freePrompt] = useState(() => FREE_PROMPTS[Math.floor(Math.random() * FREE_PROMPTS.length)]);\n\n  // Se ja fez checkin hoje, marcar como submitted\n  useEffect(() => {\n    if (todayCheckin) {\n      setSubmitted(true);\n      setResponse(todayCheckin.response || \"\");\n    }\n  }, [todayCheckin]);\n\n  const handleSubmit = async () => {\n    if (!response.trim()) return;\n    setIsSubmitting(true);\n    try {\n      await submitCheckin(response.trim());\n      setSubmitted(true);\n    } catch (err) {\n      console.error(\"Erro no checkin:\", err);\n    }\n    setIsSubmitting(false);\n  };\n\n  if (!isOpen) return null;\n\n  const hasChallenge = !!todayChallenge;\n  const challengeIcon = hasChallenge ? (CHALLENGE_ICONS[todayChallenge!.challenge_type] || \"ðŸ§ \") : \"âœ¨\";\n  const displayTitle = hasChallenge ? todayChallenge!.title : \"Check-in livre\";\n  const displayDescription = hasChallenge ? todayChallenge!.description : freePrompt;\n  const displayType = hasChallenge ? todayChallenge!.challenge_type : \"presenca\";\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-[90] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.9, opacity: 0, y: 20 }}\n          animate={{ scale: 1, opacity: 1, y: 0 }}\n          exit={{ scale: 0.9, opacity: 0, y: 20 }}\n          transition={{ type: \"spring\", damping: 20 }}\n          onClick={(e) => e.stopPropagation()}\n          className=\"w-full max-w-md bg-[#1A1A1A] border border-white/10 rounded-2xl overflow-hidden\"\n        >\n          {/* Header com streak */}\n          <div className=\"relative px-6 py-5 border-b border-white/8\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 rounded-full bg-[#C8102E]/15 border border-[#C8102E]/25 flex items-center justify-center\">\n                  <Flame className=\"h-5 w-5 text-[#C8102E]\" />\n                </div>\n                <div>\n                  <h2 className=\"text-white text-base\" style={{ fontWeight: 700 }}>Ritual do Dia</h2>\n                  <p className=\"text-white/40 text-xs\">{hasChallenge ? 'Desafio programado' : 'Presenca livre'}</p>\n                </div>\n              </div>\n              <button onClick={onClose} className=\"text-white/30 hover:text-white/60 transition-colors\">\n                <X className=\"h-5 w-5\" />\n              </button>\n            </div>\n\n            {/* Streak badge */}\n            {streak > 0 && (\n              <motion.div\n                initial={{ opacity: 0, x: 10 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"absolute top-4 right-14 flex items-center gap-1.5 bg-gradient-to-r from-[#FF6B35]/15 to-[#C8102E]/15 border border-[#FF6B35]/25 rounded-full px-3 py-1\"\n              >\n                <Zap className=\"h-3.5 w-3.5 text-[#FF6B35]\" />\n                <span className=\"text-xs text-[#FF6B35]\" style={{ fontWeight: 700 }}>\n                  {streak} {streak === 1 ? \"dia\" : \"dias\"}\n                </span>\n              </motion.div>\n            )}\n          </div>\n\n          {/* Conteudo */}\n          <div className=\"px-6 py-6\">\n            {isLoading ? (\n              <div className=\"py-8 text-center\">\n                <div className=\"w-6 h-6 border-2 border-[#81D8D0] border-t-transparent rounded-full animate-spin mx-auto\" />\n              </div>\n            ) : submitted ? (\n              /* Ja respondeu */\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"text-center py-4\"\n              >\n                <motion.div\n                  initial={{ scale: 0 }}\n                  animate={{ scale: 1 }}\n                  transition={{ type: \"spring\", damping: 12 }}\n                  className=\"text-5xl mb-4\"\n                >\n                  âœ¨\n                </motion.div>\n                <h3 className=\"text-white text-lg mb-2\" style={{ fontWeight: 700 }}>Presenca registrada</h3>\n                <p className=\"text-white/40 text-sm mb-4\">Voce esteve aqui hoje. Isso importa.</p>\n                {response && (\n                  <div className=\"bg-white/5 border border-white/8 rounded-xl p-4 text-left\">\n                    <p className=\"text-white/60 text-sm italic\">\"{response}\"</p>\n                  </div>\n                )}\n                {streak > 1 && (\n                  <motion.p\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    transition={{ delay: 0.3 }}\n                    className=\"text-[#FF6B35] text-sm mt-4\"\n                    style={{ fontWeight: 600 }}\n                  >\n                    ðŸ”¥ {streak} dias seguidos de presenca\n                  </motion.p>\n                )}\n              </motion.div>\n            ) : (\n              /* Formulario */\n              <>\n                {/* Desafio ou prompt livre */}\n                <div className=\"mb-6\">\n                  <div className=\"flex items-start gap-3 mb-4\">\n                    <span className=\"text-3xl\">{challengeIcon}</span>\n                    <div>\n                      <h3 className=\"text-white text-base mb-1\" style={{ fontWeight: 700 }}>\n                        {displayTitle}\n                      </h3>\n                      <span className=\"text-[10px] uppercase tracking-wider text-white/30 bg-white/5 px-2 py-0.5 rounded-full\" style={{ fontWeight: 600 }}>\n                        {displayType}\n                      </span>\n                    </div>\n                  </div>\n                  <p className=\"text-white/70 text-sm leading-relaxed\" style={{ fontFamily: \"Lora, serif\" }}>\n                    {displayDescription}\n                  </p>\n                </div>\n\n                {/* Campo de resposta */}\n                <div className=\"mb-5\">\n                  <textarea\n                    value={response}\n                    onChange={(e) => setResponse(e.target.value)}\n                    placeholder=\"Sua resposta... (seja honesto, isso e so seu)\"\n                    maxLength={500}\n                    rows={4}\n                    className=\"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm placeholder:text-white/25 focus:border-[#81D8D0]/30 focus:outline-none resize-none\"\n                  />\n                  <p className=\"text-white/20 text-xs text-right mt-1\">{response.length}/500</p>\n                </div>\n\n                {/* Botoes */}\n                <div className=\"flex gap-3\">\n                  <button\n                    onClick={onClose}\n                    className=\"flex-1 px-4 py-3 bg-white/5 text-white/40 rounded-xl text-sm hover:bg-white/8 transition-colors\"\n                    style={{ fontWeight: 600 }}\n                  >\n                    Pular hoje\n                  </button>\n                  <motion.button\n                    onClick={handleSubmit}\n                    disabled={!response.trim() || isSubmitting}\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-[#C8102E] text-white rounded-xl text-sm disabled:opacity-40 transition-all\"\n                    style={{ fontWeight: 700 }}\n                  >\n                    <Send className=\"h-4 w-4\" />\n                    {isSubmitting ? \"Registrando...\" : \"Registrar presenca\"}\n                  </motion.button>\n                </div>\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n"
}