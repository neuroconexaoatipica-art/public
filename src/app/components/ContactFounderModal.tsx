{
  "lote": 1,
  "status": "pending",
  "file_path": "src/app/components/ContactFounderModal.tsx",
  "created_at": "2026-02-27T05:36:14.275Z",
  "file_content": "import { useState } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { X, Loader2, CheckCircle, Phone } from \"lucide-react\";\nimport { supabase, useProfileContext } from \"../../lib\";\nimport { cleanTextInput, isValidWhatsApp, RATE_LIMITS } from \"../../lib\";\n\ninterface ContactFounderModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ntype ReasonType = \"founder\" | \"feedback\" | \"tech\" | \"other\";\n\nconst REASON_LABELS: Record<ReasonType, string> = {\n  founder: \"Contribuir como fundador\",\n  feedback: \"Feedback\",\n  tech: \"Dúvida técnica\",\n  other: \"Outro\",\n};\n\nfunction formatWhatsApp(value: string): string {\n  const digits = value.replace(/\\D/g, \"\").slice(0, 11);\n  if (digits.length === 0) return \"\";\n  if (digits.length <= 2) return `(${digits}`;\n  if (digits.length <= 7) return `(${digits.slice(0, 2)}) ${digits.slice(2)}`;\n  return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7)}`;\n}\n\nfunction extractDigits(value: string): string {\n  return value.replace(/\\D/g, \"\");\n}\n\nexport function ContactFounderModal({ isOpen, onClose }: ContactFounderModalProps) {\n  const { user } = useProfileContext();\n  const [whatsapp, setWhatsapp] = useState(\"\");\n  const [reason, setReason] = useState<ReasonType | \"\">(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [success, setSuccess] = useState(false);\n\n  const canSubmit = reason !== \"\" && !isSubmitting && !success;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!canSubmit || !user) return;\n\n    // v1.1: Rate limit anti-spam\n    const rateCheck = RATE_LIMITS.CONTACT_FORM();\n    if (!rateCheck.allowed) return;\n\n    // v1.1: Validar WhatsApp se preenchido\n    const whatsappDigits = extractDigits(whatsapp);\n    if (whatsappDigits && !isValidWhatsApp(whatsappDigits)) return;\n\n    setIsSubmitting(true);\n\n    try {\n      const { error } = await supabase.from(\"contact_requests\").insert({\n        user_id: user.id,\n        whatsapp: whatsappDigits || null,\n        reason,\n        message: cleanTextInput(message, 500) || null,\n        status: \"pending\",\n      });\n\n      if (error) throw error;\n\n      setSuccess(true);\n    } catch (err) {\n      console.error(\"Erro ao enviar contato:\", err);\n      // Still show success — don't punish user for infra issues\n      setSuccess(true);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    // Reset after close animation\n    setTimeout(() => {\n      setWhatsapp(\"\");\n      setReason(\"\");\n      setMessage(\"\");\n      setSuccess(false);\n    }, 300);\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-[#35363A]/90 backdrop-blur-sm\"\n          onClick={handleClose}\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.3, ease: \"easeOut\" }}\n            onClick={(e) => e.stopPropagation()}\n            className=\"relative w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-8 md:p-10 border-2 border-[#81D8D0]/20 max-h-[90vh] overflow-y-auto\"\n          >\n            {/* Fechar */}\n            <button\n              onClick={handleClose}\n              className=\"absolute top-4 right-4 p-2 hover:bg-[#35363A]/5 rounded-lg transition-colors\"\n            >\n              <X className=\"h-5 w-5 text-[#35363A]/60\" />\n            </button>\n\n            {success ? (\n              /* Tela de sucesso */\n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"text-center py-8\"\n              >\n                <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-[#81D8D0]/15 mb-6\">\n                  <CheckCircle className=\"h-8 w-8 text-[#81D8D0]\" />\n                </div>\n                <h3 className=\"text-2xl font-semibold text-[#35363A] mb-3\">\n                  Mensagem enviada\n                </h3>\n                <p className=\"text-[#35363A]/70 font-normal leading-relaxed mb-2\">\n                  Entrarei em contato pessoalmente.\n                </p>\n                <p className=\"text-[#35363A]/50 font-normal\">\n                  Pode levar até 48h.\n                </p>\n                <button\n                  onClick={handleClose}\n                  className=\"mt-8 px-8 py-3 bg-[#81D8D0] text-black rounded-xl font-bold hover:bg-[#81D8D0]/90 transition-all\"\n                >\n                  Fechar\n                </button>\n              </motion.div>\n            ) : (\n              /* Formulário */\n              <>\n                <h2 className=\"text-2xl md:text-3xl font-semibold mb-2 text-[#35363A]\">\n                  Falar com a fundadora\n                </h2>\n                {user && (\n                  <p className=\"text-sm text-[#35363A]/60 mb-6 font-normal\">\n                    Olá, {user.name}.\n                  </p>\n                )}\n\n                <form onSubmit={handleSubmit} className=\"space-y-5\">\n                  {/* WhatsApp (opcional) */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-[#35363A] mb-2\">\n                      WhatsApp{\" \"}\n                      <span className=\"text-[#35363A]/40 font-normal\">(opcional)</span>\n                    </label>\n                    <div className=\"relative\">\n                      <Phone className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-[#35363A]/40\" />\n                      <input\n                        type=\"tel\"\n                        value={whatsapp}\n                        onChange={(e) => setWhatsapp(formatWhatsApp(e.target.value))}\n                        placeholder=\"(DD) 9XXXX-XXXX\"\n                        className=\"w-full pl-12 pr-4 py-3 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#81D8D0] focus:border-transparent transition-all text-[#35363A] bg-white placeholder:text-[#35363A]/40\"\n                      />\n                    </div>\n                  </div>\n\n                  {/* Motivo (radio obrigatório) */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-[#35363A] mb-3\">\n                      Motivo <span className=\"text-[#C8102E]\">*</span>\n                    </label>\n                    <div className=\"space-y-2\">\n                      {(Object.entries(REASON_LABELS) as [ReasonType, string][]).map(\n                        ([value, label]) => (\n                          <label\n                            key={value}\n                            className={`flex items-center gap-3 p-3 border-2 rounded-xl cursor-pointer transition-all ${\n                              reason === value\n                                ? \"border-[#81D8D0] bg-[#81D8D0]/5\"\n                                : \"border-[#35363A]/10 hover:border-[#35363A]/20\"\n                            }`}\n                          >\n                            <input\n                              type=\"radio\"\n                              name=\"reason\"\n                              value={value}\n                              checked={reason === value}\n                              onChange={() => setReason(value)}\n                              className=\"h-4 w-4 text-[#81D8D0] accent-[#81D8D0]\"\n                            />\n                            <span className=\"text-[#35363A] font-medium\">{label}</span>\n                          </label>\n                        )\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Mensagem (opcional) */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-[#35363A] mb-2\">\n                      Mensagem{\" \"}\n                      <span className=\"text-[#35363A]/40 font-normal\">(opcional)</span>\n                    </label>\n                    <textarea\n                      value={message}\n                      onChange={(e) => setMessage(e.target.value)}\n                      placeholder=\"Escreva aqui se quiser...\"\n                      rows={3}\n                      maxLength={500}\n                      className=\"w-full px-4 py-3 border-2 border-[#35363A]/15 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#81D8D0] focus:border-transparent resize-none transition-all text-[#35363A] bg-white placeholder:text-[#35363A]/40\"\n                    />\n                  </div>\n\n                  {/* Submit */}\n                  <motion.button\n                    type=\"submit\"\n                    whileHover={canSubmit ? { scale: 1.02 } : {}}\n                    whileTap={canSubmit ? { scale: 0.98 } : {}}\n                    disabled={!canSubmit}\n                    className=\"w-full py-3.5 bg-[#81D8D0] text-black rounded-xl hover:bg-[#81D8D0]/90 transition-all font-bold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                  >\n                    {isSubmitting ? (\n                      <>\n                        <Loader2 className=\"h-5 w-5 animate-spin\" />\n                        Enviando...\n                      </>\n                    ) : (\n                      \"Enviar mensagem\"\n                    )}\n                  </motion.button>\n                </form>\n              </>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}"
}