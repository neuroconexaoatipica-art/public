{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/EventDetailPage.tsx",
  "created_at": "2026-02-27T05:36:20.489Z",
  "file_content": "import { useState } from \"react\";\nimport { motion } from \"motion/react\";\nimport { ArrowLeft, Calendar, Clock, MapPin, Video, Users, Flame, Star, CheckCircle, ExternalLink, Trash2, Edit3, XCircle } from \"lucide-react\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { LiveQuestionsPanel } from \"./LiveQuestionsPanel\";\nimport { useEventDetail } from \"../../lib/useEvents\";\nimport { useEvents } from \"../../lib/useEvents\";\nimport { EVENT_TYPE_LABELS, RITUAL_TYPE_LABELS, RITUAL_TYPE_DESCRIPTIONS, LOCATION_TYPE_LABELS, EVENT_STATUS_LABELS } from \"../../lib/useEvents\";\nimport { useProfileContext, isSuperAdmin, hasModAccess } from \"../../lib\";\n\n// ─── Formatação de data nativa (sem date-fns) ──────────────\nconst fmtFull = new Intl.DateTimeFormat(\"pt-BR\", { weekday: \"long\", day: \"numeric\", month: \"long\" });\nconst fmtTime = new Intl.DateTimeFormat(\"pt-BR\", { hour: \"2-digit\", minute: \"2-digit\" });\n\ninterface EventDetailPageProps {\n  eventId: string;\n  onBack: () => void;\n  onNavigateToProfile: (userId: string) => void;\n}\n\nconst EVENT_TYPE_COLORS: Record<string, string> = {\n  live: '#C8102E',\n  workshop: '#FF6B35',\n  ritual: '#6B21A8',\n  encontro: '#81D8D0',\n  debate: '#1E3A8A',\n  oficina: '#065F46',\n  outro: '#374151',\n};\n\nexport function EventDetailPage({ eventId, onBack, onNavigateToProfile }: EventDetailPageProps) {\n  const { event, participants, isLoading, refresh } = useEventDetail(eventId);\n  const { joinEvent, leaveEvent, deleteEvent } = useEvents();\n  const { user } = useProfileContext();\n  const [actionLoading, setActionLoading] = useState(false);\n\n  const canManage = event && (\n    event.host_id === user?.id || \n    isSuperAdmin(user?.role) || \n    hasModAccess(user?.role)\n  );\n\n  const handleJoin = async () => {\n    setActionLoading(true);\n    try { await joinEvent(eventId); await refresh(); } \n    finally { setActionLoading(false); }\n  };\n\n  const handleLeave = async () => {\n    setActionLoading(true);\n    try { await leaveEvent(eventId); await refresh(); } \n    finally { setActionLoading(false); }\n  };\n\n  const handleDelete = async () => {\n    if (!confirm('Tem certeza que deseja cancelar este evento?')) return;\n    setActionLoading(true);\n    try { \n      await deleteEvent(eventId); \n      onBack();\n    } finally { \n      setActionLoading(false); \n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"w-12 h-12 border-4 border-[#81D8D0] border-t-transparent rounded-full animate-spin\" />\n      </div>\n    );\n  }\n\n  if (!event) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-white/60 mb-4\">Evento nao encontrado</p>\n          <button onClick={onBack} className=\"text-[#81D8D0] hover:underline\">Voltar</button>\n        </div>\n      </div>\n    );\n  }\n\n  const typeColor = EVENT_TYPE_COLORS[event.event_type] || '#374151';\n  const startDate = new Date(event.starts_at);\n  const isPast = new Date() > startDate && event.status !== 'live';\n  const isFull = event.max_participants !== null && event.participant_count >= event.max_participants;\n  const isRitual = event.event_type === 'ritual';\n\n  return (\n    <div className=\"min-h-screen bg-black\">\n      {/* Header */}\n      <div className=\"w-full bg-[#35363A] border-b border-white/10 sticky top-0 z-40\">\n        <div className=\"mx-auto max-w-[800px] px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <button\n              onClick={onBack}\n              className=\"flex items-center gap-2 text-white/80 hover:text-[#81D8D0] transition-colors\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n              <span>Eventos</span>\n            </button>\n            {canManage && (\n              <button\n                onClick={handleDelete}\n                disabled={actionLoading}\n                className=\"flex items-center gap-1.5 px-3 py-1.5 text-[#C8102E] hover:bg-[#C8102E]/10 rounded-lg text-sm transition-colors\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n                Cancelar Evento\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"mx-auto max-w-[800px] px-6 py-8\">\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}>\n          {/* Cover */}\n          {event.cover_image_url && (\n            <div className=\"h-48 rounded-2xl bg-cover bg-center mb-6 relative overflow-hidden\"\n              style={{ backgroundImage: `url(${event.cover_image_url})` }}>\n              <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\n            </div>\n          )}\n\n          {/* Status badge bar */}\n          <div className=\"flex items-center gap-2 mb-4 flex-wrap\">\n            <span className=\"px-3 py-1 rounded-full text-xs\" style={{ backgroundColor: `${typeColor}30`, color: typeColor }}>\n              {isRitual && <Flame className=\"inline h-3 w-3 mr-1 -mt-0.5\" />}\n              {isRitual && event.ritual_type\n                ? RITUAL_TYPE_LABELS[event.ritual_type]\n                : EVENT_TYPE_LABELS[event.event_type]}\n            </span>\n            \n            <span className={`px-3 py-1 rounded-full text-xs ${\n              event.status === 'live' ? 'bg-[#C8102E] text-white animate-pulse' :\n              event.status === 'published' ? 'bg-[#81D8D0]/20 text-[#81D8D0]' :\n              event.status === 'completed' ? 'bg-white/10 text-white/40' :\n              event.status === 'cancelled' ? 'bg-[#C8102E]/20 text-[#C8102E]' :\n              'bg-white/10 text-white/40'\n            }`}>\n              {EVENT_STATUS_LABELS[event.status]}\n            </span>\n\n            {event.community_name && (\n              <span className=\"px-3 py-1 bg-white/5 text-white/50 rounded-full text-xs\">\n                {event.community_name}\n              </span>\n            )}\n          </div>\n\n          {/* Titulo */}\n          <h1 className=\"text-3xl text-white mb-4 leading-tight\">{event.title}</h1>\n\n          {/* Host */}\n          <div className=\"flex items-center gap-3 mb-6\">\n            <UserAvatar \n              name={event.host_name} \n              photoUrl={event.host_photo} \n              size=\"md\" \n              onClick={() => event.host_id && onNavigateToProfile(event.host_id)}\n            />\n            <div>\n              <p className=\"text-sm text-white\">{event.host_name}</p>\n              <p className=\"text-xs text-white/40\">Organizador(a)</p>\n            </div>\n          </div>\n\n          {/* Info grid */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6\">\n            <div className=\"flex items-center gap-3 p-4 bg-white/3 border border-white/10 rounded-xl\">\n              <Calendar className=\"h-5 w-5 text-[#81D8D0]\" />\n              <div>\n                <p className=\"text-sm text-white\">\n                  {fmtFull.format(startDate)}\n                </p>\n                <p className=\"text-xs text-white/40\">\n                  {fmtTime.format(startDate)}\n                  {event.ends_at && ` — ${fmtTime.format(new Date(event.ends_at))}`}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-4 bg-white/3 border border-white/10 rounded-xl\">\n              {event.location_type === 'online' ? (\n                <Video className=\"h-5 w-5 text-[#81D8D0]\" />\n              ) : (\n                <MapPin className=\"h-5 w-5 text-[#81D8D0]\" />\n              )}\n              <div>\n                <p className=\"text-sm text-white\">{LOCATION_TYPE_LABELS[event.location_type]}</p>\n                {event.location_url && (\n                  <a href={event.location_url} target=\"_blank\" rel=\"noopener noreferrer\"\n                    className=\"text-xs text-[#81D8D0] hover:underline flex items-center gap-1\">\n                    Acessar sala <ExternalLink className=\"h-3 w-3\" />\n                  </a>\n                )}\n                {event.location_address && (\n                  <p className=\"text-xs text-white/40\">{event.location_address}</p>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 p-4 bg-white/3 border border-white/10 rounded-xl\">\n              <Users className=\"h-5 w-5 text-[#81D8D0]\" />\n              <div>\n                <p className=\"text-sm text-white\">\n                  {event.participant_count} participante{event.participant_count !== 1 ? 's' : ''}\n                </p>\n                {event.max_participants && (\n                  <p className=\"text-xs text-white/40\">{event.max_participants} vagas no total</p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Botao de acao */}\n          {!isPast && event.status !== 'cancelled' && (\n            <div className=\"mb-8\">\n              {event.is_participating ? (\n                <button\n                  onClick={handleLeave}\n                  disabled={actionLoading}\n                  className=\"w-full flex items-center justify-center gap-2 px-6 py-4 bg-[#81D8D0]/20 border border-[#81D8D0]/30 text-[#81D8D0] rounded-xl hover:bg-[#81D8D0]/10 transition-colors disabled:opacity-50\"\n                >\n                  <CheckCircle className=\"h-5 w-5\" />\n                  Voce esta {event.my_status === 'interested' ? 'interessado(a)' : 'confirmado(a)'} — Clique para sair\n                </button>\n              ) : (\n                <div className=\"flex gap-3\">\n                  <button\n                    onClick={handleJoin}\n                    disabled={actionLoading || isFull}\n                    className=\"flex-1 flex items-center justify-center gap-2 px-6 py-4 bg-[#81D8D0] text-black rounded-xl hover:bg-[#81D8D0]/90 transition-colors disabled:opacity-50\"\n                  >\n                    <Star className=\"h-5 w-5\" />\n                    {isFull ? 'Lotado' : 'Confirmar Presenca'}\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Descricao */}\n          {event.description && (\n            <div className=\"mb-8\">\n              <h3 className=\"text-sm text-white/40 uppercase tracking-wide mb-3\">Sobre o evento</h3>\n              <div className=\"p-5 bg-white/3 border border-white/10 rounded-xl\">\n                <p className=\"text-white/80 whitespace-pre-wrap leading-relaxed\">{event.description}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Ritual context */}\n          {isRitual && event.ritual_type && (\n            <div className=\"mb-8\">\n              <h3 className=\"text-sm text-white/40 uppercase tracking-wide mb-3 flex items-center gap-2\">\n                <Flame className=\"h-4 w-4 text-[#6B21A8]\" />\n                Sobre este ritual\n              </h3>\n              <div className=\"p-5 bg-[#6B21A8]/10 border border-[#6B21A8]/30 rounded-xl\">\n                <p className=\"text-white/70 leading-relaxed font-manifesto\">\n                  {RITUAL_TYPE_DESCRIPTIONS[event.ritual_type]}\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* ═══ PERGUNTAS PARA A LIVE ═══ */}\n          {(event.event_type === 'live' || event.event_type === 'workshop') && (\n            <div className=\"mb-8\">\n              <LiveQuestionsPanel\n                eventId={eventId}\n                currentUserId={user?.id}\n                isHost={!!canManage}\n                onNavigateToProfile={onNavigateToProfile}\n              />\n            </div>\n          )}\n\n          {/* Participantes */}\n          <div>\n            <h3 className=\"text-sm text-white/40 uppercase tracking-wide mb-3\">\n              Participantes ({participants.length})\n            </h3>\n            {participants.length === 0 ? (\n              <p className=\"text-sm text-white/30 p-4 bg-white/3 border border-white/10 rounded-xl text-center\">\n                Nenhum participante ainda. Seja o primeiro!\n              </p>\n            ) : (\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\n                {participants.map((p) => (\n                  <button\n                    key={p.user_id}\n                    onClick={() => onNavigateToProfile(p.user_id)}\n                    className=\"flex items-center gap-3 p-3 bg-white/3 border border-white/10 rounded-xl hover:bg-white/5 transition-colors\"\n                  >\n                    <UserAvatar name={p.name} photoUrl={p.photo} size=\"sm\" />\n                    <div className=\"min-w-0\">\n                      <p className=\"text-sm text-white truncate\">{p.name}</p>\n                      <p className=\"text-xs text-white/30\">\n                        {p.status === 'confirmed' ? 'Confirmado(a)' : 'Interessado(a)'}\n                      </p>\n                    </div>\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n}"
}