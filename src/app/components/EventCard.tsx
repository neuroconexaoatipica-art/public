{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/EventCard.tsx",
  "created_at": "2026-02-27T05:36:20.665Z",
  "file_content": "import { UserAvatar } from \"./UserAvatar\";\nimport type { EventWithMeta } from \"../../lib/useEvents\";\nimport { EVENT_TYPE_LABELS, RITUAL_TYPE_LABELS, LOCATION_TYPE_LABELS } from \"../../lib/useEvents\";\nimport { motion } from \"motion/react\";\nimport { Calendar, Clock, MapPin, Users, Video, Flame, CheckCircle, Star, User } from \"lucide-react\";\n\n// ─── Formatação de data nativa (sem date-fns) ──────────────\nconst fmtShort = new Intl.DateTimeFormat(\"pt-BR\", { day: \"numeric\", month: \"short\", hour: \"2-digit\", minute: \"2-digit\" });\nconst fmtTime = new Intl.DateTimeFormat(\"pt-BR\", { hour: \"2-digit\", minute: \"2-digit\" });\n\nfunction isPastDate(d: Date): boolean { return d.getTime() < Date.now(); }\nfunction isTodayDate(d: Date): boolean {\n  const now = new Date();\n  return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth() && d.getDate() === now.getDate();\n}\nfunction isTomorrowDate(d: Date): boolean {\n  const tomorrow = new Date();\n  tomorrow.setDate(tomorrow.getDate() + 1);\n  return d.getFullYear() === tomorrow.getFullYear() && d.getMonth() === tomorrow.getMonth() && d.getDate() === tomorrow.getDate();\n}\nfunction diffMinutes(a: Date, b: Date): number { return Math.round((a.getTime() - b.getTime()) / 60000); }\n\ninterface EventCardProps {\n  event: EventWithMeta;\n  onClick: (event: EventWithMeta) => void;\n  onJoin?: (eventId: string) => void;\n  onLeave?: (eventId: string) => void;\n  compact?: boolean;\n}\n\nconst EVENT_TYPE_COLORS: Record<string, string> = {\n  live: '#C8102E',\n  workshop: '#FF6B35',\n  ritual: '#6B21A8',\n  encontro: '#81D8D0',\n  debate: '#1E3A8A',\n  oficina: '#065F46',\n  outro: '#374151',\n};\n\nexport function EventCard({ event, onClick, onJoin, onLeave, compact = false }: EventCardProps) {\n  const startDate = new Date(event.starts_at);\n  const isEventPast = isPastDate(startDate) && event.status !== 'live';\n  const isLive = event.status === 'live';\n  const isEventToday = isTodayDate(startDate);\n  const isEventTomorrow = isTomorrowDate(startDate);\n\n  const typeColor = EVENT_TYPE_COLORS[event.event_type] || '#374151';\n\n  const getTimeLabel = () => {\n    if (isLive) return 'Ao Vivo Agora';\n    if (isEventToday) {\n      const mins = diffMinutes(startDate, new Date());\n      if (mins > 0 && mins < 60) return `Em ${mins} min`;\n      if (mins >= 60 && mins < 120) return `Em 1h`;\n      return `Hoje, ${fmtTime.format(startDate)}`;\n    }\n    if (isEventTomorrow) return `Amanha, ${fmtTime.format(startDate)}`;\n    return fmtShort.format(startDate);\n  };\n\n  const isFull = event.max_participants !== null && event.participant_count >= event.max_participants;\n\n  if (compact) {\n    return (\n      <button\n        onClick={() => onClick(event)}\n        className=\"w-full text-left flex items-center gap-3 p-3 bg-white/3 hover:bg-white/5 border border-white/10 rounded-xl transition-all group\"\n      >\n        <div\n          className=\"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0\"\n          style={{ backgroundColor: `${typeColor}30` }}\n        >\n          <Calendar className=\"h-5 w-5\" style={{ color: typeColor }} />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm text-white truncate\">{event.title}</p>\n          <p className=\"text-xs text-white/40\">{getTimeLabel()}</p>\n        </div>\n        {isLive && (\n          <span className=\"px-2 py-0.5 bg-[#C8102E] text-white text-xs rounded-full animate-pulse\">\n            LIVE\n          </span>\n        )}\n      </button>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={`bg-white/3 border border-white/10 rounded-2xl overflow-hidden hover:border-white/20 transition-all cursor-pointer ${isEventPast ? 'opacity-60' : ''}`}\n      onClick={() => onClick(event)}\n    >\n      {/* Cover ou Header colorido */}\n      {event.cover_image_url ? (\n        <div className=\"h-32 bg-cover bg-center relative\" style={{ backgroundImage: `url(${event.cover_image_url})` }}>\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent\" />\n          <div className=\"absolute top-3 left-3 flex gap-2\">\n            <TypeBadge type={event.event_type} ritualType={event.ritual_type} color={typeColor} />\n            {isLive && <LiveBadge />}\n          </div>\n        </div>\n      ) : (\n        <div className=\"h-3 w-full\" style={{ backgroundColor: typeColor }} />\n      )}\n\n      <div className=\"p-5\">\n        {/* Badges */}\n        {!event.cover_image_url && (\n          <div className=\"flex items-center gap-2 mb-3\">\n            <TypeBadge type={event.event_type} ritualType={event.ritual_type} color={typeColor} />\n            {isLive && <LiveBadge />}\n            {event.community_name && (\n              <span className=\"text-xs text-white/40 ml-auto truncate max-w-[140px]\">\n                {event.community_name}\n              </span>\n            )}\n          </div>\n        )}\n\n        {/* Titulo */}\n        <h3 className=\"text-lg text-white mb-2 leading-tight\">{event.title}</h3>\n\n        {/* Descricao truncada */}\n        {event.description && (\n          <p className=\"text-sm text-white/50 mb-4 line-clamp-2\">{event.description}</p>\n        )}\n\n        {/* Meta info */}\n        <div className=\"space-y-2 mb-4\">\n          <div className=\"flex items-center gap-2 text-sm text-white/60\">\n            <Clock className=\"h-4 w-4 text-[#81D8D0]\" />\n            <span>{getTimeLabel()}</span>\n            {event.ends_at && (\n              <span className=\"text-white/30\">\n                — {fmtTime.format(new Date(event.ends_at))}\n              </span>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-2 text-sm text-white/60\">\n            {event.location_type === 'online' ? (\n              <Video className=\"h-4 w-4 text-[#81D8D0]\" />\n            ) : (\n              <MapPin className=\"h-4 w-4 text-[#81D8D0]\" />\n            )}\n            <span>{LOCATION_TYPE_LABELS[event.location_type]}</span>\n          </div>\n\n          <div className=\"flex items-center gap-2 text-sm text-white/60\">\n            <Users className=\"h-4 w-4 text-[#81D8D0]\" />\n            <span>\n              {event.participant_count} participante{event.participant_count !== 1 ? 's' : ''}\n              {event.max_participants && (\n                <span className=\"text-white/30\"> / {event.max_participants} vagas</span>\n              )}\n            </span>\n            {isFull && <span className=\"text-xs text-[#C8102E]\">Lotado</span>}\n          </div>\n        </div>\n\n        {/* Footer: Host + Acoes */}\n        <div className=\"flex items-center justify-between pt-3 border-t border-white/10\">\n          <div className=\"flex items-center gap-2\">\n            <UserAvatar name={event.host_name} photoUrl={event.host_photo} size=\"sm\" />\n            <span className=\"text-xs text-white/50\">{event.host_name}</span>\n          </div>\n\n          {!isEventPast && (\n            <div onClick={(e) => e.stopPropagation()}>\n              {event.is_participating ? (\n                <button\n                  onClick={() => onLeave?.(event.id)}\n                  className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[#81D8D0]/20 text-[#81D8D0] rounded-lg text-xs hover:bg-[#81D8D0]/10 transition-colors\"\n                >\n                  <CheckCircle className=\"h-3.5 w-3.5\" />\n                  {event.my_status === 'interested' ? 'Interessado(a)' : 'Confirmado(a)'}\n                </button>\n              ) : (\n                <button\n                  onClick={() => onJoin?.(event.id)}\n                  disabled={isFull}\n                  className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[#81D8D0] text-black rounded-lg text-xs hover:bg-[#81D8D0]/90 transition-colors disabled:opacity-40 disabled:cursor-not-allowed\"\n                >\n                  <Star className=\"h-3.5 w-3.5\" />\n                  Participar\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ─── Sub-components ──────────────────────────────────────────\n\nfunction TypeBadge({ type, ritualType, color }: { type: string; ritualType: string | null; color: string }) {\n  const label = type === 'ritual' && ritualType\n    ? RITUAL_TYPE_LABELS[ritualType as keyof typeof RITUAL_TYPE_LABELS] || 'Ritual'\n    : EVENT_TYPE_LABELS[type as keyof typeof EVENT_TYPE_LABELS] || type;\n\n  return (\n    <span\n      className=\"px-2.5 py-1 rounded-full text-xs\"\n      style={{ backgroundColor: `${color}30`, color }}\n    >\n      {type === 'ritual' && <Flame className=\"inline h-3 w-3 mr-1 -mt-0.5\" />}\n      {label}\n    </span>\n  );\n}\n\nfunction LiveBadge() {\n  return (\n    <span className=\"px-2.5 py-1 bg-[#C8102E] text-white rounded-full text-xs animate-pulse flex items-center gap-1\">\n      <span className=\"w-2 h-2 bg-white rounded-full\" />\n      AO VIVO\n    </span>\n  );\n}"
}