{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/DeleteAccountModal.tsx",
  "created_at": "2026-02-27T05:36:21.825Z",
  "file_content": "import { useState } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\nimport { X, AlertTriangle, Trash2, Loader2 } from \"lucide-react\";\nimport { supabase } from \"../../lib/supabase\";\n\ninterface DeleteAccountModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  userName: string;\n}\n\nexport function DeleteAccountModal({ isOpen, onClose, userName }: DeleteAccountModalProps) {\n  const [confirmText, setConfirmText] = useState(\"\");\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [step, setStep] = useState<'confirm' | 'final'>('confirm');\n  const [error, setError] = useState(\"\");\n\n  const expectedText = \"EXCLUIR\";\n  const canProceed = confirmText.trim().toUpperCase() === expectedText;\n\n  const handleDelete = async () => {\n    setIsDeleting(true);\n    setError(\"\");\n\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session?.access_token) throw new Error(\"Sessão expirada. Faça login novamente.\");\n\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 'https://ieieohtnaymykxiqnmlc.supabase.co';\n      const res = await fetch(\n        `${supabaseUrl}/functions/v1/delete-user`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n      const result = await res.json();\n      if (!res.ok && !result.success) throw new Error(result.error || 'Erro ao excluir conta');\n\n      await supabase.auth.signOut();\n      window.location.reload();\n    } catch (err: any) {\n      console.error('Erro ao excluir conta:', err);\n      setError(err.message || \"Erro ao excluir conta. Tente novamente.\");\n      setIsDeleting(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (isDeleting) return;\n    setConfirmText(\"\");\n    setStep('confirm');\n    setError(\"\");\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\"\n          onClick={handleClose}\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.3 }}\n            onClick={(e) => e.stopPropagation()}\n            className=\"relative w-full max-w-md mx-4 bg-[#1a1a1a] border-2 border-[#C8102E]/40 rounded-2xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto\"\n          >\n            {/* Close button */}\n            <button\n              onClick={handleClose}\n              disabled={isDeleting}\n              className=\"absolute top-4 right-4 p-2 hover:bg-white/5 rounded-lg transition-colors disabled:opacity-50\"\n            >\n              <X className=\"h-5 w-5 text-white/60\" />\n            </button>\n\n            {step === 'confirm' ? (\n              <>\n                {/* Warning Icon */}\n                <div className=\"flex justify-center mb-6\">\n                  <div className=\"w-16 h-16 bg-[#C8102E]/20 rounded-full flex items-center justify-center\">\n                    <AlertTriangle className=\"h-8 w-8 text-[#C8102E]\" />\n                  </div>\n                </div>\n\n                <h2 className=\"text-2xl font-semibold text-white text-center mb-3\">\n                  Excluir minha conta\n                </h2>\n\n                <div className=\"bg-[#C8102E]/10 border border-[#C8102E]/30 rounded-xl p-4 mb-6\">\n                  <p className=\"text-sm text-white/80 leading-relaxed\">\n                    <strong className=\"text-[#C8102E]\">Atencao:</strong> Esta acao e irreversivel. Ao excluir sua conta, serao removidos permanentemente:\n                  </p>\n                  <ul className=\"mt-3 space-y-1.5 text-sm text-white/70\">\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-[#C8102E]\">&bull;</span>\n                      <span>Seu perfil e dados pessoais</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-[#C8102E]\">&bull;</span>\n                      <span>Todos os seus posts e comentarios</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-[#C8102E]\">&bull;</span>\n                      <span>Sua foto de perfil</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-[#C8102E]\">&bull;</span>\n                      <span>Numero de WhatsApp e autorizacoes</span>\n                    </li>\n                  </ul>\n                </div>\n\n                <button\n                  onClick={() => setStep('final')}\n                  className=\"w-full py-3 bg-[#C8102E]/20 border-2 border-[#C8102E]/40 text-[#C8102E] rounded-xl font-semibold hover:bg-[#C8102E]/30 transition-all\"\n                >\n                  Entendo e quero continuar\n                </button>\n\n                <button\n                  onClick={handleClose}\n                  className=\"w-full py-3 mt-3 bg-white/5 text-white/60 rounded-xl font-medium hover:bg-white/10 transition-all\"\n                >\n                  Cancelar\n                </button>\n              </>\n            ) : (\n              <>\n                {/* Final step */}\n                <div className=\"flex justify-center mb-6\">\n                  <div className=\"w-16 h-16 bg-[#C8102E]/20 rounded-full flex items-center justify-center\">\n                    <Trash2 className=\"h-8 w-8 text-[#C8102E]\" />\n                  </div>\n                </div>\n\n                <h2 className=\"text-2xl font-semibold text-white text-center mb-3\">\n                  Confirmacao final\n                </h2>\n\n                <p className=\"text-sm text-white/70 text-center mb-6\">\n                  {userName}, para confirmar a exclusao, digite <strong className=\"text-[#C8102E]\">EXCLUIR</strong> no campo abaixo:\n                </p>\n\n                <input\n                  type=\"text\"\n                  value={confirmText}\n                  onChange={(e) => setConfirmText(e.target.value)}\n                  placeholder='Digite \"EXCLUIR\"'\n                  disabled={isDeleting}\n                  className=\"w-full px-4 py-3 bg-black/50 border-2 border-[#C8102E]/30 rounded-xl text-white text-center font-mono text-lg placeholder:text-white/20 focus:outline-none focus:border-[#C8102E] transition-all disabled:opacity-50\"\n                  autoFocus\n                />\n\n                {error && (\n                  <div className=\"mt-4 p-3 bg-[#C8102E]/10 border border-[#C8102E]/30 rounded-xl\">\n                    <p className=\"text-sm text-[#C8102E]\">{error}</p>\n                  </div>\n                )}\n\n                <button\n                  onClick={handleDelete}\n                  disabled={!canProceed || isDeleting}\n                  className=\"w-full py-3 mt-6 bg-[#C8102E] text-white rounded-xl font-bold hover:bg-[#C8102E]/90 transition-all disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                >\n                  {isDeleting ? (\n                    <>\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\n                      Excluindo...\n                    </>\n                  ) : (\n                    <>\n                      <Trash2 className=\"h-5 w-5\" />\n                      Excluir minha conta permanentemente\n                    </>\n                  )}\n                </button>\n\n                <button\n                  onClick={() => { setStep('confirm'); setConfirmText(\"\"); setError(\"\"); }}\n                  disabled={isDeleting}\n                  className=\"w-full py-3 mt-3 bg-white/5 text-white/60 rounded-xl font-medium hover:bg-white/10 transition-all disabled:opacity-50\"\n                >\n                  Voltar\n                </button>\n              </>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}"
}