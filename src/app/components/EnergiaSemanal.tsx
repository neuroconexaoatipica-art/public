{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/EnergiaSemanal.tsx",
  "created_at": "2026-02-27T05:36:27.907Z",
  "file_content": "/**\n * EnergiaSemanal â€” Painel de energia e reconhecimento semanal\n * \n * Mostra: Top 3 membros ativos, comunidade mais viva,\n * ritual mais participado, founder mais engajado.\n * Sem ranking toxico. Reconhecimento simbolico.\n * \n * Exibido na sidebar do SocialHub.\n */\n\nimport { useState, useEffect } from \"react\";\nimport { motion } from \"motion/react\";\nimport { Flame, Crown, Users, Sparkles, Zap, Trophy } from \"lucide-react\";\nimport { supabase } from \"../../lib/supabase\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { InlineBadges } from \"./InlineBadges\";\n\ninterface TopMember {\n  id: string;\n  name: string;\n  display_name: string;\n  profile_photo: string | null;\n  participation_score: number;\n}\n\ninterface TopCommunity {\n  id: string;\n  name: string;\n  post_count: number;\n}\n\ninterface TopRitual {\n  ritual_type: string;\n  count: number;\n}\n\ninterface TopFounder {\n  id: string;\n  name: string;\n  display_name: string;\n  profile_photo: string | null;\n  participation_score: number;\n}\n\ninterface EnergiaSemanalProps {\n  onNavigateToProfile?: (userId: string) => void;\n}\n\nexport function EnergiaSemanal({ onNavigateToProfile }: EnergiaSemanalProps) {\n  const [topMembers, setTopMembers] = useState<TopMember[]>([]);\n  const [topCommunity, setTopCommunity] = useState<TopCommunity | null>(null);\n  const [topRitual, setTopRitual] = useState<TopRitual | null>(null);\n  const [topFounder, setTopFounder] = useState<TopFounder | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    async function loadEnergy() {\n      try {\n        // Top 3 membros por participation_score\n        const { data: members } = await supabase\n          .from(\"users\")\n          .select(\"id, name, display_name, profile_photo, participation_score\")\n          .in(\"role\", [\"member_free_legacy\", \"member_paid\", \"founder_paid\", \"moderator\"])\n          .eq(\"is_public_profile\", true)\n          .order(\"participation_score\", { ascending: false })\n          .limit(3);\n\n        if (members) setTopMembers(members as TopMember[]);\n\n        // Comunidade mais viva (mais posts na ultima semana)\n        const oneWeekAgo = new Date(Date.now() - 7 * 86400000).toISOString();\n        const { data: recentPosts } = await supabase\n          .from(\"posts\")\n          .select(\"community_id\")\n          .gte(\"created_at\", oneWeekAgo);\n\n        if (recentPosts && recentPosts.length > 0) {\n          const countMap: Record<string, number> = {};\n          recentPosts.forEach((p: any) => {\n            if (p.community_id) {\n              countMap[p.community_id] = (countMap[p.community_id] || 0) + 1;\n            }\n          });\n\n          const topId = Object.entries(countMap).sort((a, b) => b[1] - a[1])[0];\n          if (topId) {\n            const { data: comm } = await supabase\n              .from(\"communities\")\n              .select(\"id, name\")\n              .eq(\"id\", topId[0])\n              .single();\n            if (comm) {\n              setTopCommunity({ id: comm.id, name: comm.name, post_count: topId[1] });\n            }\n          }\n        }\n\n        // Ritual mais participado na ultima semana\n        const { data: recentRituals } = await supabase\n          .from(\"ritual_logs\")\n          .select(\"ritual_type\")\n          .gte(\"completed_at\", oneWeekAgo);\n\n        if (recentRituals && recentRituals.length > 0) {\n          const ritualCount: Record<string, number> = {};\n          recentRituals.forEach((r: any) => {\n            if (r.ritual_type) {\n              ritualCount[r.ritual_type] = (ritualCount[r.ritual_type] || 0) + 1;\n            }\n          });\n          const topRit = Object.entries(ritualCount).sort((a, b) => b[1] - a[1])[0];\n          if (topRit) {\n            setTopRitual({ ritual_type: topRit[0], count: topRit[1] });\n          }\n        }\n\n        // Founder mais engajado\n        const { data: founders } = await supabase\n          .from(\"users\")\n          .select(\"id, name, display_name, profile_photo, participation_score\")\n          .in(\"role\", [\"founder_paid\"])\n          .eq(\"is_public_profile\", true)\n          .order(\"participation_score\", { ascending: false })\n          .limit(1);\n\n        if (founders && founders.length > 0) {\n          setTopFounder(founders[0] as TopFounder);\n        }\n      } catch (err) {\n        console.error(\"[EnergiaSemanal] Erro:\", err);\n      } finally {\n        setIsLoading(false);\n      }\n    }\n\n    loadEnergy();\n  }, []);\n\n  if (isLoading || topMembers.length === 0) return null;\n\n  const POSITION_STYLES = [\n    { icon: Zap, color: \"#FFD700\", label: \"1o\" },\n    { icon: Flame, color: \"#FF6B35\", label: \"2o\" },\n    { icon: Sparkles, color: \"#81D8D0\", label: \"3o\" },\n  ];\n\n  const RITUAL_LABELS: Record<string, string> = {\n    daily: \"Ritual Diario\",\n    weekly: \"Ritual Semanal\",\n    monthly: \"Ritual Mensal\",\n    territorial: \"Encontro Territorial\",\n    entry: \"Ritual de Entrada\",\n    roda_de_escuta: \"Roda de Escuta\",\n    checkin_coletivo: \"Check-in Coletivo\",\n    sessao_de_foco: \"Sessao de Foco\",\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-white/3 border border-white/10 rounded-2xl p-5\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-4\">\n        <div className=\"w-7 h-7 rounded-lg bg-[#FFD700]/15 flex items-center justify-center\">\n          <Trophy className=\"h-4 w-4 text-[#FFD700]\" />\n        </div>\n        <div>\n          <h3 className=\"text-xs text-white uppercase tracking-wider font-bold\">Energia da Semana</h3>\n          <span className=\"text-[9px] text-white/25\">Reconhecimento simbolico</span>\n        </div>\n      </div>\n\n      {/* Top 3 membros */}\n      <div className=\"space-y-2 mb-4\">\n        {topMembers.map((member, idx) => {\n          const style = POSITION_STYLES[idx];\n          const IconComp = style.icon;\n          const displayName = member.display_name || member.name;\n\n          return (\n            <div\n              key={member.id}\n              className=\"flex items-center gap-3 p-2 rounded-xl hover:bg-white/5 cursor-pointer transition-colors group\"\n              onClick={() => onNavigateToProfile?.(member.id)}\n            >\n              <div className=\"relative\">\n                <UserAvatar name={displayName} photoUrl={member.profile_photo} size=\"sm\" />\n                <div\n                  className=\"absolute -bottom-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center border border-black\"\n                  style={{ background: style.color }}\n                >\n                  <IconComp className=\"h-2.5 w-2.5 text-black\" />\n                </div>\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-1\">\n                  <p className=\"text-xs text-white font-semibold truncate group-hover:text-[#81D8D0] transition-colors\">\n                    {displayName}\n                  </p>\n                  <InlineBadges userId={member.id} maxVisible={2} />\n                </div>\n                <p className=\"text-[10px] text-white/30\">{member.participation_score} pts</p>\n              </div>\n              <span\n                className=\"text-[10px] font-bold px-1.5 py-0.5 rounded-full\"\n                style={{ background: `${style.color}20`, color: style.color }}\n              >\n                {style.label}\n              </span>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Comunidade mais viva */}\n      {topCommunity && (\n        <div className=\"pt-3 border-t border-white/8\">\n          <div className=\"flex items-center gap-2\">\n            <Users className=\"h-3.5 w-3.5 text-[#81D8D0]\" />\n            <span className=\"text-[10px] text-white/30 font-semibold\">Mais viva:</span>\n            <span className=\"text-[10px] text-[#81D8D0] font-bold truncate\">{topCommunity.name}</span>\n            <span className=\"text-[9px] text-white/20 ml-auto\">{topCommunity.post_count} posts</span>\n          </div>\n        </div>\n      )}\n\n      {/* Ritual mais participado */}\n      {topRitual && (\n        <div className=\"pt-3 border-t border-white/8\">\n          <div className=\"flex items-center gap-2\">\n            <Flame className=\"h-3.5 w-3.5 text-[#FF6B35]\" />\n            <span className=\"text-[10px] text-white/30 font-semibold\">Ritual top:</span>\n            <span className=\"text-[10px] text-[#FF6B35] font-bold truncate\">{RITUAL_LABELS[topRitual.ritual_type] || topRitual.ritual_type}</span>\n            <span className=\"text-[9px] text-white/20 ml-auto\">{topRitual.count}x</span>\n          </div>\n        </div>\n      )}\n\n      {/* Founder mais engajado */}\n      {topFounder && (\n        <div className=\"pt-3 border-t border-white/8\">\n          <div\n            className=\"flex items-center gap-2 cursor-pointer hover:bg-white/5 rounded-lg p-1 -m-1 transition-colors\"\n            onClick={() => onNavigateToProfile?.(topFounder.id)}\n          >\n            <Crown className=\"h-3.5 w-3.5 text-[#FFD700]\" />\n            <span className=\"text-[10px] text-white/30 font-semibold\">Founder:</span>\n            <UserAvatar name={topFounder.display_name || topFounder.name} photoUrl={topFounder.profile_photo} size=\"xs\" />\n            <span className=\"text-[10px] text-[#FFD700] font-bold truncate\">{topFounder.display_name || topFounder.name}</span>\n            <InlineBadges userId={topFounder.id} maxVisible={2} />\n          </div>\n        </div>\n      )}\n    </motion.div>\n  );\n}"
}