{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/MenteEmDestaque.tsx",
  "created_at": "2026-02-27T05:36:27.118Z",
  "file_content": "/**\n * MenteEmDestaque — Destaque semanal de um membro\n * \n * Seleciona automaticamente o membro com maior participation_score\n * que ainda nao foi destacado recentemente, OU usa selecao manual\n * via tabela `weekly_spotlights` (se existir).\n * \n * Fallback: se nao ha dados, seleciona por score.\n * Exibido no SocialHub (sidebar direita).\n */\n\nimport { useState, useEffect } from \"react\";\nimport { motion } from \"motion/react\";\nimport { Sparkles, Star, Trophy, MessageCircle } from \"lucide-react\";\nimport { supabase } from \"../../lib/supabase\";\nimport { UserAvatar } from \"./UserAvatar\";\n\ninterface SpotlightMember {\n  id: string;\n  name: string;\n  display_name: string;\n  profile_photo: string | null;\n  bio: string | null;\n  participation_score: number;\n  interests: string[];\n  deep_statement: string | null;\n  deep_statement_public: boolean;\n}\n\ninterface MenteEmDestaqueProps {\n  onNavigateToProfile?: (userId: string) => void;\n}\n\nexport function MenteEmDestaque({ onNavigateToProfile }: MenteEmDestaqueProps) {\n  const [member, setMember] = useState<SpotlightMember | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    async function loadSpotlight() {\n      try {\n        // Estrategia 1: tentar tabela weekly_spotlights (manual)\n        const { data: spotlight } = await supabase\n          .from(\"weekly_spotlights\")\n          .select(\"user_id, reason\")\n          .gte(\"week_start\", getWeekStart())\n          .lte(\"week_start\", getWeekEnd())\n          .order(\"created_at\", { ascending: false })\n          .limit(1)\n          .maybeSingle();\n\n        let userId: string | null = spotlight?.user_id || null;\n\n        // Estrategia 2: fallback — membro com maior score\n        if (!userId) {\n          const { data: topMembers } = await supabase\n            .from(\"users\")\n            .select(\"id\")\n            .in(\"role\", [\"member_free_legacy\", \"member_paid\", \"founder_paid\", \"moderator\"])\n            .eq(\"is_public_profile\", true)\n            .order(\"participation_score\", { ascending: false })\n            .limit(5);\n\n          if (topMembers && topMembers.length > 0) {\n            // Selecionar baseado no dia da semana (rotacao deterministica)\n            const dayOfYear = Math.floor((Date.now() - new Date(new Date().getFullYear(), 0, 0).getTime()) / 86400000);\n            const weekIndex = Math.floor(dayOfYear / 7) % topMembers.length;\n            userId = topMembers[weekIndex].id;\n          }\n        }\n\n        if (!userId) {\n          setIsLoading(false);\n          return;\n        }\n\n        // Carregar dados completos\n        const { data: userData } = await supabase\n          .from(\"users\")\n          .select(\"id, name, display_name, profile_photo, bio, participation_score, interests, deep_statement, deep_statement_public\")\n          .eq(\"id\", userId)\n          .single();\n\n        if (userData) {\n          setMember(userData as SpotlightMember);\n        }\n      } catch (err) {\n        // Tabela weekly_spotlights pode nao existir — nao e erro\n        // Fallback silencioso: tentar so pelo score\n        try {\n          const { data: topMembers } = await supabase\n            .from(\"users\")\n            .select(\"id, name, display_name, profile_photo, bio, participation_score, interests, deep_statement, deep_statement_public\")\n            .in(\"role\", [\"member_free_legacy\", \"member_paid\", \"founder_paid\", \"moderator\"])\n            .eq(\"is_public_profile\", true)\n            .order(\"participation_score\", { ascending: false })\n            .limit(1);\n\n          if (topMembers && topMembers.length > 0) {\n            setMember(topMembers[0] as SpotlightMember);\n          }\n        } catch {\n          // silencioso\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    }\n\n    loadSpotlight();\n  }, []);\n\n  if (isLoading || !member) return null;\n\n  const displayName = member.display_name || member.name;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-gradient-to-br from-[#FF6B35]/10 via-transparent to-[#81D8D0]/10 border border-[#FF6B35]/20 rounded-2xl p-5\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-4\">\n        <div className=\"w-7 h-7 rounded-lg bg-[#FF6B35]/15 flex items-center justify-center\">\n          <Sparkles className=\"h-4 w-4 text-[#FF6B35]\" />\n        </div>\n        <div>\n          <h3 className=\"text-xs text-white uppercase tracking-wider font-bold\">Mente em Destaque</h3>\n          <span className=\"text-[9px] text-white/30\">Destaque da semana</span>\n        </div>\n      </div>\n\n      {/* Member card */}\n      <div\n        className=\"flex items-center gap-3 cursor-pointer group\"\n        onClick={() => onNavigateToProfile?.(member.id)}\n      >\n        <UserAvatar\n          name={displayName}\n          photoUrl={member.profile_photo}\n          size=\"lg\"\n        />\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm text-white font-bold truncate group-hover:text-[#81D8D0] transition-colors\">\n            {displayName}\n          </p>\n          <div className=\"flex items-center gap-1.5 mt-0.5\">\n            <Trophy className=\"h-3 w-3 text-[#FF6B35]\" />\n            <span className=\"text-[10px] text-[#FF6B35] font-semibold\">\n              {member.participation_score} pts\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Deep statement */}\n      {member.deep_statement && member.deep_statement_public && (\n        <div className=\"mt-3 bg-white/5 rounded-xl p-3 border border-white/8\">\n          <p className=\"text-xs text-white/60 italic leading-relaxed\">\n            &ldquo;{member.deep_statement}&rdquo;\n          </p>\n        </div>\n      )}\n\n      {/* Bio snippet */}\n      {!member.deep_statement && member.bio && (\n        <p className=\"mt-3 text-xs text-white/40 leading-relaxed line-clamp-2\">\n          {member.bio}\n        </p>\n      )}\n\n      {/* Interests */}\n      {member.interests && member.interests.length > 0 && (\n        <div className=\"flex flex-wrap gap-1 mt-3\">\n          {member.interests.slice(0, 3).map((interest) => (\n            <span\n              key={interest}\n              className=\"text-[9px] px-2 py-0.5 bg-white/5 border border-white/10 rounded-full text-white/40\"\n            >\n              {interest}\n            </span>\n          ))}\n        </div>\n      )}\n\n      {/* CTA */}\n      <button\n        onClick={() => onNavigateToProfile?.(member.id)}\n        className=\"mt-4 w-full flex items-center justify-center gap-2 px-3 py-2 bg-[#FF6B35]/10 hover:bg-[#FF6B35]/20 border border-[#FF6B35]/25 rounded-xl text-[#FF6B35] text-xs font-bold transition-all\"\n      >\n        <Star className=\"h-3 w-3\" />\n        Ver perfil completo\n      </button>\n    </motion.div>\n  );\n}\n\n// Helpers para semana\nfunction getWeekStart(): string {\n  const now = new Date();\n  const day = now.getDay();\n  const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n  const monday = new Date(now.setDate(diff));\n  monday.setHours(0, 0, 0, 0);\n  return monday.toISOString();\n}\n\nfunction getWeekEnd(): string {\n  const start = new Date(getWeekStart());\n  start.setDate(start.getDate() + 6);\n  start.setHours(23, 59, 59, 999);\n  return start.toISOString();\n}\n"
}