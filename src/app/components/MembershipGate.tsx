{
  "lote": 4,
  "status": "pending",
  "file_path": "src/app/components/MembershipGate.tsx",
  "created_at": "2026-02-27T05:36:25.249Z",
  "file_content": "import { useState } from \"react\";\nimport { motion } from \"motion/react\";\nimport { Lock, Send, Check, Clock, XCircle, Loader2, ArrowLeft } from \"lucide-react\";\nimport { useCommunityMembership } from \"../../lib/useCommunityMembership\";\nimport type { MembershipStatus } from \"../../lib/useCommunityMembership\";\n\n/**\n * MembershipGate — Portão de entrada por comunidade\n * \n * Se a comunidade tem requires_approval = true e o user não é membro,\n * exibe este portão em vez do conteúdo. O user pode pedir entrada.\n * \n * Uso dentro de CommunityPage:\n * ```\n * <MembershipGate communityId={community.id} communityName={community.name}>\n *   {/* conteúdo normal da comunidade *\\/}\n * </MembershipGate>\n * ```\n */\n\ninterface MembershipGateProps {\n  communityId: string | undefined;\n  communityName: string;\n  communityColor?: string;\n  onBack?: () => void;\n  children: React.ReactNode;\n}\n\nexport function MembershipGate({\n  communityId,\n  communityName,\n  communityColor = \"#C8102E\",\n  onBack,\n  children,\n}: MembershipGateProps) {\n  const { status, canView, isLoading, requestEntry, requiresApproval } = useCommunityMembership(communityId);\n  const [message, setMessage] = useState(\"\");\n  const [sending, setSending] = useState(false);\n  const [sent, setSent] = useState(false);\n\n  // Carregando membership\n  if (isLoading) {\n    return (\n      <div className=\"min-h-[400px] flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-white/30\" />\n      </div>\n    );\n  }\n\n  // Se pode ver, renderizar children normalmente\n  if (canView) {\n    return <>{children}</>;\n  }\n\n  // Gate ativo — user não é membro e comunidade requer aprovação\n  const handleRequest = async () => {\n    setSending(true);\n    const result = await requestEntry(message);\n    setSending(false);\n    if (result.success) {\n      setSent(true);\n    }\n  };\n\n  const statusConfig: Record<NonNullable<MembershipStatus>, { icon: React.ReactNode; title: string; desc: string; showForm: boolean }> = {\n    pending: {\n      icon: <Clock className=\"h-10 w-10 text-[#FF6B35]\" />,\n      title: \"Pedido em analise\",\n      desc: `Seu pedido para entrar em ${communityName} foi recebido. O moderador vai analisar em breve.`,\n      showForm: false,\n    },\n    rejected: {\n      icon: <XCircle className=\"h-10 w-10 text-[#C8102E]\" />,\n      title: \"Pedido nao aprovado\",\n      desc: `Seu pedido para ${communityName} nao foi aprovado desta vez. Se quiser, pode tentar novamente com uma nova mensagem.`,\n      showForm: true,\n    },\n    approved: {\n      icon: <Check className=\"h-10 w-10 text-[#0A8F85]\" />,\n      title: \"Acesso liberado\",\n      desc: \"Voce ja e membro!\",\n      showForm: false,\n    },\n  };\n\n  const currentStatus = status ? statusConfig[status] : null;\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-6\" style={{ background: \"#0A0A0A\" }}>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"max-w-md w-full\"\n      >\n        {/* Voltar */}\n        {onBack && (\n          <button\n            onClick={onBack}\n            className=\"flex items-center gap-2 text-white/40 hover:text-white/70 text-sm mb-6 transition-colors\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" /> Voltar\n          </button>\n        )}\n\n        <div className=\"bg-white/5 border border-white/10 rounded-2xl p-6 text-center\">\n          {/* Se já tem status (pending/rejected) */}\n          {currentStatus && !sent ? (\n            <>\n              <div className=\"mb-4\">{currentStatus.icon}</div>\n              <h2 className=\"text-xl text-white mb-2\" style={{ fontWeight: 700 }}>\n                {currentStatus.title}\n              </h2>\n              <p className=\"text-sm text-white/50 mb-6\">{currentStatus.desc}</p>\n\n              {currentStatus.showForm && (\n                <div className=\"space-y-3 text-left\">\n                  <textarea\n                    value={message}\n                    onChange={(e) => setMessage(e.target.value)}\n                    placeholder=\"Por que voce quer entrar nesta comunidade? (opcional)\"\n                    rows={3}\n                    className=\"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm placeholder:text-white/30 focus:border-white/25 focus:outline-none resize-none\"\n                  />\n                  <button\n                    onClick={handleRequest}\n                    disabled={sending}\n                    className=\"w-full py-3 rounded-xl text-white text-sm transition-all hover:opacity-90 disabled:opacity-50\"\n                    style={{ fontWeight: 600, backgroundColor: communityColor }}\n                  >\n                    {sending ? (\n                      <span className=\"flex items-center justify-center gap-2\">\n                        <Loader2 className=\"h-4 w-4 animate-spin\" /> Enviando...\n                      </span>\n                    ) : (\n                      <span className=\"flex items-center justify-center gap-2\">\n                        <Send className=\"h-4 w-4\" /> Tentar novamente\n                      </span>\n                    )}\n                  </button>\n                </div>\n              )}\n            </>\n          ) : sent ? (\n            /* Pedido enviado com sucesso */\n            <>\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ type: \"spring\", damping: 15 }}\n              >\n                <Check className=\"h-12 w-12 text-[#0A8F85] mx-auto mb-4\" />\n              </motion.div>\n              <h2 className=\"text-xl text-white mb-2\" style={{ fontWeight: 700 }}>\n                Pedido enviado!\n              </h2>\n              <p className=\"text-sm text-white/50\">\n                O moderador de {communityName} vai analisar seu pedido. Voce recebera uma notificacao quando for aprovado.\n              </p>\n            </>\n          ) : (\n            /* Primeiro acesso — nunca pediu entrada */\n            <>\n              <div\n                className=\"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4\"\n                style={{ background: `${communityColor}15`, border: `2px solid ${communityColor}30` }}\n              >\n                <Lock className=\"h-8 w-8\" style={{ color: communityColor }} />\n              </div>\n\n              <h2 className=\"text-xl text-white mb-2\" style={{ fontWeight: 700 }}>\n                {communityName}\n              </h2>\n              <p className=\"text-sm text-white/50 mb-6\">\n                Esta comunidade tem entrada por aprovacao. Envie um pedido e o moderador vai analisar.\n              </p>\n\n              <div className=\"space-y-3 text-left\">\n                <textarea\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  placeholder=\"Por que voce quer entrar nesta comunidade? (opcional, mas ajuda na aprovacao)\"\n                  rows={3}\n                  className=\"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm placeholder:text-white/30 focus:border-white/25 focus:outline-none resize-none\"\n                />\n                <button\n                  onClick={handleRequest}\n                  disabled={sending}\n                  className=\"w-full py-3 rounded-xl text-white text-sm transition-all hover:opacity-90 disabled:opacity-50\"\n                  style={{ fontWeight: 600, backgroundColor: communityColor }}\n                >\n                  {sending ? (\n                    <span className=\"flex items-center justify-center gap-2\">\n                      <Loader2 className=\"h-4 w-4 animate-spin\" /> Enviando...\n                    </span>\n                  ) : (\n                    <span className=\"flex items-center justify-center gap-2\">\n                      <Send className=\"h-4 w-4\" /> Pedir entrada\n                    </span>\n                  )}\n                </button>\n              </div>\n            </>\n          )}\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n"
}