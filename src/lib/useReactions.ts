{
  "lote": 0,
  "status": "pending",
  "file_path": "src/lib/useReactions.ts",
  "created_at": "2026-02-27T05:36:07.729Z",
  "file_content": "import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from './supabase';\n\nexport type ReactionType = 'senti_isso' | 'me_provocou' | 'gratidao' | 'intenso' | 'coragem' | 'lucidez';\n\nexport const REACTION_LABELS: Record<ReactionType, { emoji: string; label: string }> = {\n  senti_isso:   { emoji: 'üíî', label: 'Senti isso' },\n  me_provocou:  { emoji: '‚ö°', label: 'Me provocou' },\n  gratidao:     { emoji: 'üôè', label: 'Gratidao' },\n  intenso:      { emoji: 'üî•', label: 'Intenso' },\n  coragem:      { emoji: 'üõ°Ô∏è', label: 'Coragem' },\n  lucidez:      { emoji: 'üíé', label: 'Lucidez' },\n};\n\nexport interface ReactionCount {\n  type: ReactionType;\n  count: number;\n}\n\nexport function useReactions(postId: string) {\n  const [counts, setCounts] = useState<ReactionCount[]>([]);\n  const [myReaction, setMyReaction] = useState<ReactionType | null>(null);\n  const [totalCount, setTotalCount] = useState(0);\n\n  const load = useCallback(async () => {\n    if (!postId) return;\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n\n      // Buscar todas as reacoes deste post\n      const { data, error } = await supabase\n        .from('reactions')\n        .select('reaction_type, user_id')\n        .eq('post_id', postId);\n\n      if (error) throw error;\n\n      // Contar por tipo\n      const countMap: Record<string, number> = {};\n      let myR: ReactionType | null = null;\n      (data || []).forEach(r => {\n        countMap[r.reaction_type] = (countMap[r.reaction_type] || 0) + 1;\n        if (user && r.user_id === user.id) myR = r.reaction_type as ReactionType;\n      });\n\n      const countsArr: ReactionCount[] = Object.entries(countMap).map(([type, count]) => ({ type: type as ReactionType, count }));\n      setCounts(countsArr);\n      setMyReaction(myR);\n      setTotalCount((data || []).length);\n    } catch (err) {\n      console.error('[useReactions] Erro:', err);\n    }\n  }, [postId]);\n\n  useEffect(() => { load(); }, [load]);\n\n  const toggleReaction = useCallback(async (type: ReactionType) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      if (myReaction === type) {\n        // Remover reacao\n        await supabase.from('reactions').delete().eq('user_id', user.id).eq('post_id', postId);\n        setMyReaction(null);\n      } else if (myReaction) {\n        // Trocar tipo\n        await supabase.from('reactions').update({ reaction_type: type }).eq('user_id', user.id).eq('post_id', postId);\n        setMyReaction(type);\n      } else {\n        // Nova reacao\n        await supabase.from('reactions').insert({ user_id: user.id, post_id: postId, reaction_type: type });\n        setMyReaction(type);\n      }\n      await load();\n    } catch (err) {\n      console.error('[useReactions] Erro ao reagir:', err);\n    }\n  }, [myReaction, postId, load]);\n\n  return { counts, myReaction, totalCount, toggleReaction };\n}\n"
}